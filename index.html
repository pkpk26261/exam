<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>考試時間表</title>
    
    <!-- 網站圖示 Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%231a1a2e'/><stop offset='100%25' style='stop-color:%230f3460'/></linearGradient></defs><rect width='100' height='100' rx='15' fill='url(%23bg)'/><text x='50' y='65' font-size='50' text-anchor='middle' fill='%23e94560'>📋</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%231a1a2e'/><stop offset='100%25' style='stop-color:%230f3460'/></linearGradient></defs><rect width='100' height='100' rx='15' fill='url(%23bg)'/><text x='50' y='65' font-size='50' text-anchor='middle' fill='%23e94560'>📋</text></svg>">
    <!-- 備用：純文字 emoji favicon（相容性更好） -->
    <link rel="alternate icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📋</text></svg>">
    
    <!-- PWA 相關設定 -->
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="考試時間">
    
    <style>
        :root {
            --base-font-size: 14px;
            --header-title-size: 1.8rem;
            --time-display-size: 3rem;
            --date-display-size: 1.1rem;
            --countdown-size: 2.8rem;
            --section-title-size: 1.2rem;
            --normal-text-size: 1rem;
            --small-text-size: 0.9rem;
            --countdown-info-size: 1.8rem;
            --input-text-size: 1rem;
            --attendance-input-size: 1.8rem;
            --spacing-unit: 12px;
            --border-radius: 10px;
        }

        /* 支援 clamp() 的現代瀏覽器 */
        @supports (font-size: clamp(1px, 1vw, 2px)) {
            :root {
                --base-font-size: clamp(12px, 1.2vw, 16px);
                --header-title-size: clamp(1.4rem, 2.5vw, 2.2rem);
                --time-display-size: clamp(2rem, 4vw, 4rem);
                --date-display-size: clamp(0.9rem, 1.4vw, 1.4rem);
                --countdown-size: clamp(1.8rem, 3.5vw, 3.5rem);
                --section-title-size: clamp(1rem, 1.4vw, 1.4rem);
                --normal-text-size: clamp(0.85rem, 1.1vw, 1.1rem);
                --small-text-size: clamp(0.75rem, 1vw, 1rem);
                --countdown-info-size: clamp(1.3rem, 2.5vw, 2.5rem);
                --input-text-size: clamp(0.9rem, 1.1vw, 1.1rem);
                --attendance-input-size: clamp(1.4rem, 2.2vw, 2.2rem);
                --spacing-unit: clamp(8px, 1vw, 15px);
                --border-radius: clamp(8px, 1vw, 15px);
            }
        }

        * {
            margin: 0;
            padding: 0;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }


        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', Arial, sans-serif;
            font-size: 14px;
            font-size: var(--base-font-size);
            background: #1a1a2e;
            background: -webkit-linear-gradient(315deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            background: -moz-linear-gradient(315deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            background: -o-linear-gradient(315deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #fff;
            height: 100vh;
            overflow: hidden;
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            -moz-box-orient: vertical;
            -moz-box-direction: normal;
            -ms-flex-direction: column;
            flex-direction: column;
        }

        /* 頂部標題區 */
        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px 24px;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 2);
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: justify;
            -webkit-justify-content: space-between;
            -moz-box-pack: justify;
            -ms-flex-pack: justify;
            justify-content: space-between;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            border-bottom: 3px solid #e94560;
        }

        .header h1 {
            font-size: 1.8rem;
            font-size: var(--header-title-size);
            color: #e94560;
            text-shadow: 0 0 10px rgba(233, 69, 96, 0.5);
        }

        .current-time {
            font-size: 3rem;
            font-size: var(--time-display-size);
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 15px rgba(255,255,255,0.7);
            font-family: 'Consolas', monospace;
        }

        .current-date {
            font-size: 1.1rem;
            font-size: var(--date-display-size);
            color: #aaa;
        }

        /* 主要內容區 */
        .main-container {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            -moz-box-flex: 1;
            -ms-flex: 1;
            flex: 1;
            padding: 12px;
            padding: var(--spacing-unit);
            overflow: hidden;
        }

        .main-container > * {
            margin-right: 12px;
            margin-right: var(--spacing-unit);
        }

        .main-container > *:last-child {
            margin-right: 0;
        }

        /* 左側：考試節次列表 */
        .schedule-panel {
            -webkit-box-flex: 1;
            -webkit-flex: 1 1 55%;
            -moz-box-flex: 1;
            -ms-flex: 1 1 55%;
            flex: 1 1 55%;
            background: rgba(255, 255, 255, 0.05);
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            border-radius: var(--border-radius);
            padding: 12px;
            padding: var(--spacing-unit);
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            -moz-box-orient: vertical;
            -moz-box-direction: normal;
            -ms-flex-direction: column;
            flex-direction: column;
            position: relative;
            -webkit-transition: all 0.3s ease;
            -moz-transition: all 0.3s ease;
            -o-transition: all 0.3s ease;
            transition: all 0.3s ease;
            min-width: 0;
        }

        .schedule-panel.collapsed {
            -webkit-box-flex: 0;
            -webkit-flex: 0 0 45px;
            -moz-box-flex: 0;
            -ms-flex: 0 0 45px;
            flex: 0 0 45px;
            padding: 12px 8px;
            padding: var(--spacing-unit) calc(var(--spacing-unit) * 0.7);
            overflow: hidden;
        }

        .schedule-panel.collapsed .schedule-header,
        .schedule-panel.collapsed .schedule-list {
            display: none;
        }

        .schedule-panel.collapsed .panel-toggle {
            -webkit-transform: rotate(180deg);
            -moz-transform: rotate(180deg);
            -ms-transform: rotate(180deg);
            -o-transform: rotate(180deg);
            transform: rotate(180deg);
        }

        .panel-toggle {
            position: absolute;
            top: 50%;
            right: -15px;
            -webkit-transform: translateY(-50%);
            -moz-transform: translateY(-50%);
            -ms-transform: translateY(-50%);
            -o-transform: translateY(-50%);
            transform: translateY(-50%);
            width: 27px;
            height: 54px;
            background: rgba(233, 69, 96, 0.8);
            border: none;
            -webkit-border-radius: 0 10px 10px 0;
            -moz-border-radius: 0 10px 10px 0;
            border-radius: 0 10px 10px 0;
            color: #fff;
            cursor: pointer;
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            -moz-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            font-size: 1rem;
            font-size: var(--normal-text-size);
            -webkit-transition: all 0.3s ease;
            -moz-transition: all 0.3s ease;
            -o-transition: all 0.3s ease;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .panel-toggle:hover {
            background: #e94560;
            right: -18px;
            width: 36px;
        }

        .collapsed-label {
            display: none;
            -webkit-writing-mode: vertical-rl;
            -ms-writing-mode: tb-rl;
            writing-mode: vertical-rl;
            -webkit-text-orientation: mixed;
            text-orientation: mixed;
            font-size: 1rem;
            font-size: var(--normal-text-size);
            color: #e94560;
            font-weight: bold;
            padding: 12px 0;
            padding: var(--spacing-unit) 0;
        }

        .schedule-panel.collapsed .collapsed-label {
            display: block;
        }

        .schedule-header {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            padding: 10px 12px;
            padding: calc(var(--spacing-unit) * 0.8) var(--spacing-unit);
            background: rgba(233, 69, 96, 0.3);
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            border-radius: var(--border-radius);
            font-weight: bold;
            font-size: 1rem;
            font-size: var(--normal-text-size);
            margin-bottom: 10px;
            margin-bottom: calc(var(--spacing-unit) * 0.8);
        }

        .schedule-header span {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            -moz-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            text-align: center;
        }

        .schedule-header span:nth-child(1) {
            width: 10%;
            min-width: 50px;
        }

        .schedule-header span:nth-child(2) {
            width: 25%;
            min-width: 100px;
        }

        .schedule-header span:nth-child(3) {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            -moz-box-flex: 1;
            -ms-flex: 1;
            flex: 1;
        }

        .schedule-header span:nth-child(4) {
            width: 12%;
            min-width: 50px;
        }

        .schedule-list {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            -moz-box-flex: 1;
            -ms-flex: 1;
            flex: 1;
            overflow-y: auto;
            scroll-behavior: smooth;
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            -moz-box-orient: vertical;
            -moz-box-direction: normal;
            -ms-flex-direction: column;
            flex-direction: column;
        }

        .schedule-list > * {
            margin-bottom: 8px;
        }

        .schedule-list > *:last-child {
            margin-bottom: 0;
        }

        .schedule-item {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            padding: 10px 12px;
            padding: calc(var(--spacing-unit) * 0.8) var(--spacing-unit);
            background: rgba(255, 255, 255, 0.08);
            -webkit-border-radius: 8px;
            -moz-border-radius: 8px;
            border-radius: 8px;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-transition: all 0.3s ease;
            -moz-transition: all 0.3s ease;
            -o-transition: all 0.3s ease;
            transition: all 0.3s ease;
            border-left: 5px solid transparent;
        }

        .schedule-item > *:nth-child(1) {
            width: 10%;
            min-width: 50px;
        }

        .schedule-item > *:nth-child(2) {
            width: 25%;
            min-width: 100px;
            margin: 0 8px;
        }

        .schedule-item > *:nth-child(3) {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            -moz-box-flex: 1;
            -ms-flex: 1;
            flex: 1;
            margin: 0 8px;
        }

        .schedule-item > *:nth-child(4) {
            width: 12%;
            min-width: 50px;
        }

        .schedule-item:hover {
            background: rgba(255, 255, 255, 0.12);
        }

        .schedule-item.active {
            background: rgba(0, 217, 255, 0.15);
            border-left-color: #00d9ff;
            -webkit-box-shadow: 0 0 15px rgba(0, 217, 255, 0.3);
            -moz-box-shadow: 0 0 15px rgba(0, 217, 255, 0.3);
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.3);
        }

        .schedule-item.completed {
            opacity: 0.5;
            filter: alpha(opacity=50);
            border-left-color: #4caf50;
        }

        .schedule-item.upcoming {
            border-left-color: #ffc107;
        }

        /* 早自習時段樣式 */
        .schedule-item.morning-period {
            background: rgba(255, 193, 7, 0.1);
            border-left-color: #ffc107;
        }

        .schedule-item.morning-period .period-label {
            color: #ffc107;
        }

        .schedule-item.morning-period.active {
            background: rgba(255, 193, 7, 0.2);
            -webkit-box-shadow: 0 0 15px rgba(255, 193, 7, 0.3);
            -moz-box-shadow: 0 0 15px rgba(255, 193, 7, 0.3);
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.3);
        }

        /* 午休時段樣式 */
        .schedule-item.lunch-period {
            background: rgba(156, 39, 176, 0.1);
            border-left-color: #9c27b0;
        }

        .schedule-item.lunch-period .period-label {
            color: #9c27b0;
        }

        .schedule-item.lunch-period.active {
            background: rgba(156, 39, 176, 0.2);
            -webkit-box-shadow: 0 0 15px rgba(156, 39, 176, 0.3);
            -moz-box-shadow: 0 0 15px rgba(156, 39, 176, 0.3);
            box-shadow: 0 0 15px rgba(156, 39, 176, 0.3);
        }

        /* 非考試時段標籤 */
        .non-exam-label {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            -moz-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            width: 100%;
        }

        .non-exam-text {
            font-size: 1rem;
            font-size: var(--normal-text-size);
            color: rgba(255, 255, 255, 0.7);
            font-style: italic;
        }

        .period-label {
            font-weight: bold;
            color: #e94560;
            font-size: 1rem;
            font-size: var(--normal-text-size);
        }

        /* 將節次標籤置中 */
        .period-label {
            text-align: center;
            width: 100%;
        }

        /* 科目輸入欄容器 - 支援跑馬燈 */
        .subject-wrapper {
            position: relative;
            overflow: hidden;
            width: 100%;
        }

        .subject-input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            -webkit-border-radius: 8px;
            -moz-border-radius: 8px;
            border-radius: 8px;
            padding: 8px 10px;
            color: #fff;
            font-size: 1.1rem;
            width: 100%;
            text-align: center; /* 科目輸入文字置中 */
        }

        /* 跑馬燈顯示模式 */
        .subject-display {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            -webkit-border-radius: 8px;
            -moz-border-radius: 8px;
            border-radius: 8px;
            padding: 8px 10px;
            color: #fff;
            font-size: 1.1rem;
            display: none;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            overflow: hidden;
            cursor: pointer;
            pointer-events: none;
        }

        .subject-display.active {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            -moz-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            pointer-events: auto;
        }

        .subject-display.active + .subject-input,
        .subject-wrapper.has-value .subject-input {
            /* 當顯示區啟用時，不需要額外隱藏 input，由 JS 控制 */
        }

        .subject-input.hidden {
            visibility: hidden;
        }

        .subject-display .marquee-text {
            white-space: nowrap;
        }

        .subject-display .marquee-text.animate {
            -webkit-animation: marquee 8s linear infinite;
            -moz-animation: marquee 8s linear infinite;
            -o-animation: marquee 8s linear infinite;
            animation: marquee 8s linear infinite;
        }

        .subject-display:hover .marquee-text {
            -webkit-animation-play-state: paused;
            -moz-animation-play-state: paused;
            -o-animation-play-state: paused;
            animation-play-state: paused;
        }

        @-webkit-keyframes marquee {
            0% { -webkit-transform: translateX(0); transform: translateX(0); }
            100% { -webkit-transform: translateX(-50%); transform: translateX(-50%); }
        }

        @-moz-keyframes marquee {
            0% { -moz-transform: translateX(0); transform: translateX(0); }
            100% { -moz-transform: translateX(-50%); transform: translateX(-50%); }
        }

        @-o-keyframes marquee {
            0% { -o-transform: translateX(0); transform: translateX(0); }
            100% { -o-transform: translateX(-50%); transform: translateX(-50%); }
        }

        @keyframes marquee {
            0% { -webkit-transform: translateX(0); -moz-transform: translateX(0); -o-transform: translateX(0); transform: translateX(0); }
            100% { -webkit-transform: translateX(-50%); -moz-transform: translateX(-50%); -o-transform: translateX(-50%); transform: translateX(-50%); }
        }

        

        .subject-input:focus + .subject-display {
            display: none !important;
        }

        .subject-input:focus {
            outline: none;
            border-color: #00d9ff;
            -webkit-box-shadow: 0 0 5px rgba(0, 217, 255, 0.5);
            -moz-box-shadow: 0 0 5px rgba(0, 217, 255, 0.5);
            box-shadow: 0 0 5px rgba(0, 217, 255, 0.5);
        }

        .time-inputs {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            -moz-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center; /* 水平置中考試時間欄內的輸入元件 */
        }

        .time-inputs > * {
            margin-right: 6px;
        }

        .time-inputs > *:last-child {
            margin-right: 0;
        }

        .time-input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            -webkit-border-radius: 6px;
            -moz-border-radius: 6px;
            border-radius: 6px;
            padding: 6px 4px;
            color: #fff;
            font-size: 1rem;
            font-size: var(--input-text-size);
            width: 110px;
            min-width: 110px;
            max-width: 110px;
            text-align: center;
            color-scheme: dark;
        }

        .time-input::-webkit-calendar-picker-indicator {
            display: none;
            -webkit-appearance: none;
            opacity: 0;
            width: 0;
            padding: 0;
            margin: 0;
        }

        .time-input::-webkit-inner-spin-button,
        .time-input::-webkit-clear-button {
            display: none;
            -webkit-appearance: none;
        }

        .time-input:focus {
            outline: none;
            border-color: #00d9ff;
        }

        .time-separator {
            color: #aaa;
            font-size: 1rem;
            font-size: var(--input-text-size);
        }

        .duration-display {
            font-size: 0.9rem;
            font-size: var(--small-text-size);
            color: #ffc107;
            text-align: center;
            font-weight: bold;
        }

        /* 右側面板 */
        .right-panel {
            -webkit-box-flex: 1;
            -webkit-flex: 1 1 45%;
            -moz-box-flex: 1;
            -ms-flex: 1 1 45%;
            flex: 1 1 45%;
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            -moz-box-orient: vertical;
            -moz-box-direction: normal;
            -ms-flex-direction: column;
            flex-direction: column;
            -webkit-transition: all 0.3s ease;
            -moz-transition: all 0.3s ease;
            -o-transition: all 0.3s ease;
            transition: all 0.3s ease;
            min-width: 0;
        }

        .right-panel > * {
            margin-bottom: 12px;
            margin-bottom: var(--spacing-unit);
        }

        .right-panel > *:last-child {
            margin-bottom: 0;
        }

        /* 倒數計時區 */
        .countdown-section {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
        }

        .countdown-section > * {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            -moz-box-flex: 1;
            -ms-flex: 1;
            flex: 1;
            margin-right: 12px;
            margin-right: var(--spacing-unit);
        }

        .countdown-section > *:last-child {
            margin-right: 0;
        }

        .countdown-box {
            background: rgba(255, 255, 255, 0.08);
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            border-radius: var(--border-radius);
            padding: 12px;
            padding: var(--spacing-unit);
            text-align: center;
            min-height: 140px;
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            -moz-box-orient: vertical;
            -moz-box-direction: normal;
            -ms-flex-direction: column;
            flex-direction: column;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            -moz-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
        }

        .countdown-box h3 {
            font-size: 1rem;
            font-size: var(--normal-text-size);
            color: #aaa;
            margin-bottom: 6px;
            margin-bottom: calc(var(--spacing-unit) * 0.5);
        }

        .countdown-value {
            font-size: 2.8rem;
            font-size: var(--countdown-size);
            font-weight: bold;
            font-family: 'Consolas', monospace;
        }

        .countdown-box.next-exam .countdown-value {
            color: #ffc107;
            text-shadow: 0 0 10px rgba(255, 193, 7, 0.7);
        }

        .countdown-box.remaining .countdown-value {
            color: #f44336;
            text-shadow: 0 0 10px rgba(244, 67, 54, 0.7);
        }

        .countdown-box.warning .countdown-value {
            color: #ff9800;
        }

        .countdown-box.danger .countdown-value {
            color: #f44336;
            -webkit-animation: blink 1s infinite;
            -moz-animation: blink 1s infinite;
            -o-animation: blink 1s infinite;
            animation: blink 1s infinite;
        }

        @-webkit-keyframes blink {
            50% { opacity: 0.5; filter: alpha(opacity=50); }
        }

        @-moz-keyframes blink {
            50% { opacity: 0.5; }
        }

        @-o-keyframes blink {
            50% { opacity: 0.5; }
        }

        @keyframes blink {
            50% { opacity: 0.5; filter: alpha(opacity=50); }
        }

        .current-exam-info {
            font-size: 1.5rem;
            font-size: var(--countdown-info-size);
            color: #00d9ff;
            margin-top: 6px;
            margin-top: calc(var(--spacing-unit) * 0.5);
            min-height: 2.2em;
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            -moz-box-orient: vertical;
            -moz-box-direction: normal;
            -ms-flex-direction: column;
            flex-direction: column;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            -moz-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            line-height: 1.2;
        }

        .current-exam-info.multiline {
            font-size: 1.2rem;
            font-size: calc(var(--countdown-info-size) * 0.8);
        }

        /* 人數統計區 */
        .attendance-section {
            background: rgba(255, 255, 255, 0.08);
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            border-radius: var(--border-radius);
            padding: 12px;
            padding: var(--spacing-unit);
        }

        .attendance-section h3 {
            font-size: 1.2rem;
            font-size: var(--section-title-size);
            color: #e94560;
            margin-bottom: 12px;
            margin-bottom: var(--spacing-unit);
            padding-bottom: 8px;
            padding-bottom: calc(var(--spacing-unit) * 0.7);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .attendance-grid {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
        }

        .attendance-grid > * {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            -moz-box-flex: 1;
            -ms-flex: 1;
            flex: 1;
            margin-right: 12px;
            margin-right: var(--spacing-unit);
        }

        .attendance-grid > *:last-child {
            margin-right: 0;
        }

        .attendance-item {
            text-align: center;
        }

        .attendance-item label {
            display: block;
            font-size: 1rem;
            font-size: var(--normal-text-size);
            color: #aaa;
            margin-bottom: 6px;
            margin-bottom: calc(var(--spacing-unit) * 0.5);
        }

        .attendance-input {
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid rgba(255, 255, 255, 0.2);
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            border-radius: var(--border-radius);
            padding: 12px;
            padding: var(--spacing-unit);
            color: #fff;
            font-size: 1.8rem;
            font-size: var(--attendance-input-size);
            font-weight: bold;
            width: 100%;
            text-align: center;
        }

        .attendance-input:focus {
            outline: none;
            border-color: #00d9ff;
        }

        .attendance-input.expected {
            border-color: rgba(0, 217, 255, 0.5);
        }

        .attendance-input.actual {
            border-color: rgba(76, 175, 80, 0.5);
        }

        .remarks-input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            border-radius: var(--border-radius);
            padding: 10px;
            padding: calc(var(--spacing-unit) * 0.8);
            color: #fff;
            font-size: 1rem;
            font-size: var(--normal-text-size);
            width: 100%;
            resize: none;
            height: 60px;
            margin-top: 12px;
            margin-top: var(--spacing-unit);
        }

        .remarks-input:focus {
            outline: none;
            border-color: #00d9ff;
        }

        /* 輪播容器 */
        .carousel-container {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            -moz-box-flex: 1;
            -ms-flex: 1;
            flex: 1;
            position: relative;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.08);
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            border-radius: var(--border-radius);
        }

        .carousel-slides {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-transition: -webkit-transform 0.5s ease;
            -moz-transition: -moz-transform 0.5s ease;
            -o-transition: -o-transform 0.5s ease;
            transition: transform 0.5s ease;
            height: 100%;
        }

        .carousel-slide {
            min-width: 100%;
            height: 100%;
            padding: 12px;
            padding: var(--spacing-unit);
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            -moz-box-orient: vertical;
            -moz-box-direction: normal;
            -ms-flex-direction: column;
            flex-direction: column;
        }

        .carousel-slide h3 {
            font-size: 1.2rem;
            font-size: var(--section-title-size);
            color: #e94560;
            margin: 0;
            padding: 0;
            border: none;
        }

        .carousel-controls {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            z-index: 20;
        }

        .carousel-controls > * {
            margin-left: 10px;
        }

        .carousel-controls > *:first-child {
            margin-left: 0;
        }

        .carousel-indicators {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            background: rgba(0, 0, 0, 0.4);
            padding: 6px 12px;
            padding: 6px var(--spacing-unit);
            -webkit-border-radius: 20px;
            -moz-border-radius: 20px;
            border-radius: 20px;
        }

        .carousel-indicators > * {
            margin-right: 8px;
        }

        .carousel-indicators > *:last-child {
            margin-right: 0;
        }

        .carousel-dot {
            width: 40px;
            height: 6px;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            -webkit-transition: all 0.3s ease;
            -moz-transition: all 0.3s ease;
            -o-transition: all 0.3s ease;
            transition: all 0.3s ease;
        }

        .carousel-dot:hover {
            background: rgba(255, 255, 255, 0.6);
        }

        .carousel-dot.active {
            background: #e94560;
        }

        .carousel-nav {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            width: 32px;
            height: 32px;
            -webkit-border-radius: 50%;
            -moz-border-radius: 50%;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            font-size: var(--normal-text-size);
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            -moz-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            -webkit-transition: all 0.3s ease;
            -moz-transition: all 0.3s ease;
            -o-transition: all 0.3s ease;
            transition: all 0.3s ease;
            opacity: 0.9;
            filter: alpha(opacity=90);
        }

        .carousel-nav:hover {
            opacity: 1;
            filter: alpha(opacity=100);
            background: #e94560;
            border-color: #e94560;
            -webkit-transform: scale(1.1);
            -moz-transform: scale(1.1);
            -ms-transform: scale(1.1);
            -o-transform: scale(1.1);
            transform: scale(1.1);
        }

        .carousel-nav:active {
            -webkit-transform: scale(0.95);
            -moz-transform: scale(0.95);
            -ms-transform: scale(0.95);
            -o-transform: scale(0.95);
            transform: scale(0.95);
        }

        .carousel-timer {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.5);
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
        }

        .carousel-timer > * {
            margin-left: 5px;
        }

        .carousel-timer > *:first-child {
            margin-left: 0;
        }

        .carousel-timer-bar {
            width: 100%;
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
            position: absolute;
            bottom: 0;
            left: 0;
        }

        .carousel-timer-progress {
            height: 100%;
            background: #e94560;
            background: -webkit-linear-gradient(left, #e94560, #00d9ff);
            background: -moz-linear-gradient(left, #e94560, #00d9ff);
            background: -o-linear-gradient(left, #e94560, #00d9ff);
            background: linear-gradient(90deg, #e94560, #00d9ff);
            -webkit-animation: timerProgress 8s linear infinite;
            -moz-animation: timerProgress 8s linear infinite;
            -o-animation: timerProgress 8s linear infinite;
            animation: timerProgress 8s linear infinite;
        }

        @-webkit-keyframes timerProgress {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        @-moz-keyframes timerProgress {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        @-o-keyframes timerProgress {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        @keyframes timerProgress {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        /* 輪播內的人數統計樣式 */
        .carousel-slide .attendance-grid {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            margin-bottom: 12px;
            margin-bottom: var(--spacing-unit);
        }

        .carousel-slide .attendance-grid > * {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            -moz-box-flex: 1;
            -ms-flex: 1;
            flex: 1;
            margin-right: 12px;
            margin-right: var(--spacing-unit);
        }

        .carousel-slide .attendance-grid > *:last-child {
            margin-right: 0;
        }

        .carousel-slide .attendance-item {
            text-align: center;
        }

        .carousel-slide .attendance-item label {
            display: block;
            font-size: 1rem;
            font-size: var(--normal-text-size);
            color: #aaa;
            margin-bottom: 6px;
            margin-bottom: calc(var(--spacing-unit) * 0.5);
        }

        .carousel-slide .attendance-input {
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid rgba(255, 255, 255, 0.2);
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            border-radius: var(--border-radius);
            padding: 12px;
            padding: var(--spacing-unit);
            color: #fff;
            font-size: 1.8rem;
            font-size: var(--attendance-input-size);
            font-weight: bold;
            width: 100%;
            text-align: center;
        }

        .carousel-slide .attendance-input:focus {
            outline: none;
            border-color: #00d9ff;
        }

        .carousel-slide .attendance-input.expected {
            border-color: rgba(0, 217, 255, 0.5);
        }

        .carousel-slide .attendance-input.actual {
            border-color: rgba(76, 175, 80, 0.5);
        }

        .carousel-slide .remarks-input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            border-radius: var(--border-radius);
            padding: 10px;
            padding: calc(var(--spacing-unit) * 0.8);
            color: #fff;
            font-size: 1rem;
            font-size: var(--normal-text-size);
            width: 100%;
            resize: none;
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            -moz-box-flex: 1;
            -ms-flex: 1;
            flex: 1;
            min-height: 50px;
        }

        /* 輪播內的規則樣式 */
        .carousel-slide .rules-content {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            -moz-box-flex: 1;
            -ms-flex: 1;
            flex: 1;
            overflow-y: auto;
            font-size: 1rem;
            font-size: var(--normal-text-size);
            line-height: 1.8;
        }

        .carousel-slide .rules-list {
            list-style: none;
        }

        .carousel-slide .rules-list li {
            padding: 6px 0;
            padding: calc(var(--spacing-unit) * 0.5) 0;
            padding-left: 20px;
            position: relative;
        }

        .carousel-slide .rules-list li::before {
            content: "•";
            color: #e94560;
            position: absolute;
            left: 4px;
            font-size: 1.2rem;
            font-size: var(--section-title-size);
        }

        .carousel-slide .rules-textarea {
            width: 100%;
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            -moz-box-flex: 1;
            -ms-flex: 1;
            flex: 1;
            background: rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.2);
            -webkit-border-radius: 6px;
            -moz-border-radius: 6px;
            border-radius: 6px;
            padding: 12px;
            padding: var(--spacing-unit);
            color: #fff;
            font-size: 1rem;
            font-size: var(--normal-text-size);
            line-height: 1.8;
            resize: none;
            display: none;
        }

        .carousel-slide .rules-textarea:focus {
            outline: none;
            border-color: #00d9ff;
        }

        /* 雙擊編輯提示 - 已隱藏 */
        .editable-hint {
            display: none;
        }

        .carousel-slide .rules-content {
            cursor: pointer;
            -webkit-transition: background 0.2s ease;
            -moz-transition: background 0.2s ease;
            -o-transition: background 0.2s ease;
            transition: background 0.2s ease;
            padding: 8px;
            padding: calc(var(--spacing-unit) * 0.7);
            margin: -8px;
            margin: calc(var(--spacing-unit) * -0.7);
        }

        .carousel-slide .rules-content:hover {
            background: rgba(255, 255, 255, 0.05);
            -webkit-border-radius: 6px;
            -moz-border-radius: 6px;
            border-radius: 6px;
        }

        /* 考試規則區 - 已整合至輪播 */

        /* 底部控制區 */
        .footer {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 24px;
            padding: calc(var(--spacing-unit) * 0.8) calc(var(--spacing-unit) * 2);
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: justify;
            -webkit-justify-content: space-between;
            -moz-box-pack: justify;
            -ms-flex-pack: justify;
            justify-content: space-between;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            border-top: 2px solid rgba(255, 255, 255, 0.1);
            -webkit-transition: opacity 0.3s ease;
            -moz-transition: opacity 0.3s ease;
            -o-transition: opacity 0.3s ease;
            transition: opacity 0.3s ease;
        }

        .footer.hidden {
            opacity: 0;
            filter: alpha(opacity=0);
            pointer-events: none;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
        }

        /* 顯示/隱藏控制列的切換按鈕 - 已移至頂部 */

        .control-buttons {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
        }

        .control-buttons > * {
            margin-right: 12px;
            margin-right: var(--spacing-unit);
        }

        .control-buttons > *:last-child {
            margin-right: 0;
        }

        /* 時間誤差調整控制 */
        .time-adjust-controls {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            background: rgba(255, 255, 255, 0.08);
            -webkit-border-radius: 8px;
            -moz-border-radius: 8px;
            border-radius: 8px;
            padding: 6px 12px;
        }

        .time-adjust-label {
            color: #aaa;
            font-size: 0.9rem;
            margin-right: 10px;
            white-space: nowrap;
        }

        .time-adjust-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 4px 8px;
            margin: 0 2px;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            -webkit-transition: all 0.2s ease;
            -moz-transition: all 0.2s ease;
            -o-transition: all 0.2s ease;
            transition: all 0.2s ease;
        }

        .time-adjust-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .time-adjust-btn.reset {
            background: rgba(233, 69, 96, 0.3);
            border-color: rgba(233, 69, 96, 0.5);
            margin-left: 8px;
        }

        .time-adjust-btn.reset:hover {
            background: rgba(233, 69, 96, 0.5);
        }

        .time-offset-display {
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            padding: 4px 12px;
            margin: 0 6px;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
            font-size: 0.9rem;
            min-width: 70px;
            text-align: center;
        }

        .time-offset-display.positive {
            color: #4caf50;
        }

        .time-offset-display.negative {
            color: #ff9800;
        }

        .time-offset-display.zero {
            color: #aaa;
        }

        .btn {
            padding: 10px 22px;
            padding: calc(var(--spacing-unit) * 0.8) calc(var(--spacing-unit) * 1.8);
            border: none;
            -webkit-border-radius: 6px;
            -moz-border-radius: 6px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-size: var(--normal-text-size);
            font-weight: bold;
            -webkit-transition: all 0.3s ease;
            -moz-transition: all 0.3s ease;
            -o-transition: all 0.3s ease;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #00d9ff;
            background: -webkit-linear-gradient(315deg, #00d9ff, #0099cc);
            background: -moz-linear-gradient(315deg, #00d9ff, #0099cc);
            background: -o-linear-gradient(315deg, #00d9ff, #0099cc);
            background: linear-gradient(135deg, #00d9ff, #0099cc);
            color: #fff;
        }

        .btn-primary:hover {
            -webkit-box-shadow: 0 0 15px rgba(0, 217, 255, 0.5);
            -moz-box-shadow: 0 0 15px rgba(0, 217, 255, 0.5);
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.5);
            -webkit-transform: translateY(-2px);
            -moz-transform: translateY(-2px);
            -ms-transform: translateY(-2px);
            -o-transform: translateY(-2px);
            transform: translateY(-2px);
        }

        .btn-success {
            background: #4caf50;
            background: -webkit-linear-gradient(315deg, #4caf50, #388e3c);
            background: -moz-linear-gradient(315deg, #4caf50, #388e3c);
            background: -o-linear-gradient(315deg, #4caf50, #388e3c);
            background: linear-gradient(135deg, #4caf50, #388e3c);
            color: #fff;
        }

        .btn-success:hover {
            -webkit-box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
            -moz-box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
            -webkit-transform: translateY(-2px);
            -moz-transform: translateY(-2px);
            -ms-transform: translateY(-2px);
            -o-transform: translateY(-2px);
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ff9800;
            background: -webkit-linear-gradient(315deg, #ff9800, #f57c00);
            background: -moz-linear-gradient(315deg, #ff9800, #f57c00);
            background: -o-linear-gradient(315deg, #ff9800, #f57c00);
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: #fff;
        }

        .btn-warning:hover {
            -webkit-box-shadow: 0 0 15px rgba(255, 152, 0, 0.5);
            -moz-box-shadow: 0 0 15px rgba(255, 152, 0, 0.5);
            box-shadow: 0 0 15px rgba(255, 152, 0, 0.5);
            -webkit-transform: translateY(-2px);
            -moz-transform: translateY(-2px);
            -ms-transform: translateY(-2px);
            -o-transform: translateY(-2px);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #f44336;
            background: -webkit-linear-gradient(315deg, #f44336, #d32f2f);
            background: -moz-linear-gradient(315deg, #f44336, #d32f2f);
            background: -o-linear-gradient(315deg, #f44336, #d32f2f);
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: #fff;
        }

        .btn-danger:hover {
            -webkit-box-shadow: 0 0 15px rgba(244, 67, 54, 0.5);
            -moz-box-shadow: 0 0 15px rgba(244, 67, 54, 0.5);
            box-shadow: 0 0 15px rgba(244, 67, 54, 0.5);
            -webkit-transform: translateY(-2px);
            -moz-transform: translateY(-2px);
            -ms-transform: translateY(-2px);
            -o-transform: translateY(-2px);
            transform: translateY(-2px);
        }

        .status-indicator {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            font-size: 1rem;
            font-size: var(--normal-text-size);
        }

        .status-indicator > * {
            margin-right: 8px;
        }

        .status-indicator > *:last-child {
            margin-right: 0;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            -webkit-border-radius: 50%;
            -moz-border-radius: 50%;
            border-radius: 50%;
            background: #4caf50;
            -webkit-animation: pulse 2s infinite;
            -moz-animation: pulse 2s infinite;
            -o-animation: pulse 2s infinite;
            animation: pulse 2s infinite;
        }

        @-webkit-keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; filter: alpha(opacity=50); }
        }

        @-moz-keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @-o-keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; filter: alpha(opacity=50); }
        }

        /* 縮放按鈕樣式 */
        .zoom-controls {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            margin-left: 10px;
        }

        .zoom-btn {
            width: 26px;
            height: 26px;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
            color: #fff;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            -moz-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            -webkit-transition: all 0.2s ease;
            -moz-transition: all 0.2s ease;
            -o-transition: all 0.2s ease;
            transition: all 0.2s ease;
            margin: 0 2px;
            line-height: 1;
        }

        .zoom-btn:hover {
            background: rgba(233, 69, 96, 0.8);
            border-color: #e94560;
            -webkit-transform: scale(1.1);
            -moz-transform: scale(1.1);
            -ms-transform: scale(1.1);
            -o-transform: scale(1.1);
            transform: scale(1.1);
        }

        .zoom-btn:active {
            -webkit-transform: scale(0.95);
            -moz-transform: scale(0.95);
            -ms-transform: scale(0.95);
            -o-transform: scale(0.95);
            transform: scale(0.95);
        }

        .zoom-label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
            margin-right: 5px;
        }

        .zoom-level {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.5);
            min-width: 32px;
            text-align: center;
        }

        /* 淺色模式 - 縮放按鈕 */
        .light-mode .zoom-btn {
            background: rgba(0, 0, 0, 0.08);
            border-color: rgba(0, 0, 0, 0.2);
            color: #2d3748;
        }

        .light-mode .zoom-btn:hover {
            background: rgba(233, 69, 96, 0.8);
            border-color: #e94560;
            color: #fff;
        }

        .light-mode .zoom-label {
            color: rgba(0, 0, 0, 0.5);
        }

        .light-mode .zoom-level {
            color: rgba(0, 0, 0, 0.4);
        }

        /* 輪播標題列布局調整 */
        .carousel-header {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            margin-bottom: 12px;
            margin-bottom: var(--spacing-unit);
            padding-bottom: 8px;
            padding-bottom: calc(var(--spacing-unit) * 0.7);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .carousel-header h3 {
            font-size: 1.2rem;
            font-size: var(--section-title-size);
            color: #e94560;
            margin: 0;
            padding: 0;
            border: none;
        }

        .carousel-header-spacer {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            -moz-box-flex: 1;
            -ms-flex: 1;
            flex: 1;
        }

        .light-mode .carousel-header {
            border-bottom-color: rgba(0, 0, 0, 0.1);
        }

        .light-mode .carousel-header h3 {
            color: #c53050;
        }

        /* 移除舊的 carousel-slide h3 樣式中的 padding-right */
        .carousel-slide h3.standalone-title {
            font-size: 1.2rem;
            font-size: var(--section-title-size);
            color: #e94560;
            margin-bottom: 12px;
            margin-bottom: var(--spacing-unit);
            padding-bottom: 8px;
            padding-bottom: calc(var(--spacing-unit) * 0.7);
            padding-right: 0;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        /* 滾動條樣式 */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            -webkit-border-radius: 3px;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            -webkit-border-radius: 3px;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* ===== 淺色模式 ===== */
        body.light-mode {
            background: #e8ecf1;
            background: -webkit-linear-gradient(315deg, #e8ecf1 0%, #d1d9e6 50%, #c8d0dc 100%);
            background: -moz-linear-gradient(315deg, #e8ecf1 0%, #d1d9e6 50%, #c8d0dc 100%);
            background: -o-linear-gradient(315deg, #e8ecf1 0%, #d1d9e6 50%, #c8d0dc 100%);
            background: linear-gradient(135deg, #e8ecf1 0%, #d1d9e6 50%, #c8d0dc 100%);
            color: #2d3748;
        }

        /* 頂部標題區 - 淺色 */
        .light-mode .header {
            background: rgba(255, 255, 255, 0.7);
            border-bottom-color: #e94560;
            -webkit-box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            -moz-box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .light-mode .header h1 {
            color: #c53050;
            text-shadow: none;
        }

        .light-mode .current-time {
            color: #1a202c;
            text-shadow: none;
        }

        .light-mode .current-date {
            color: #4a5568;
        }

        /* 左側面板 - 淺色 */
        .light-mode .schedule-panel {
            background: rgba(255, 255, 255, 0.8);
            -webkit-box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            -moz-box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .light-mode .panel-toggle {
            background: rgba(233, 69, 96, 0.9);
        }

        .light-mode .collapsed-label {
            color: #c53050;
        }

        .light-mode .schedule-header {
            background: rgba(233, 69, 96, 0.15);
            color: #2d3748;
        }

        .light-mode .schedule-item {
            background: rgba(0, 0, 0, 0.03);
            border-left-color: transparent;
        }

        .light-mode .schedule-item:hover {
            background: rgba(0, 0, 0, 0.06);
        }

        .light-mode .schedule-item.active {
            background: rgba(0, 180, 216, 0.12);
            border-left-color: #0096c7;
            -webkit-box-shadow: 0 0 10px rgba(0, 150, 199, 0.2);
            -moz-box-shadow: 0 0 10px rgba(0, 150, 199, 0.2);
            box-shadow: 0 0 10px rgba(0, 150, 199, 0.2);
        }

        .light-mode .schedule-item.completed {
            opacity: 0.6;
            filter: alpha(opacity=60);
            border-left-color: #38a169;
        }

        .light-mode .schedule-item.upcoming {
            border-left-color: #d69e2e;
        }

        .light-mode .period-label {
            color: #c53050;
        }

        .light-mode .subject-input {
            background: rgba(0, 0, 0, 0.05);
            border-color: rgba(0, 0, 0, 0.15);
            color: #2d3748;
        }

        .light-mode .subject-input::-webkit-input-placeholder { color: #718096; }
        .light-mode .subject-input:-moz-placeholder { color: #718096; }
        .light-mode .subject-input::-moz-placeholder { color: #718096; }
        .light-mode .subject-input:-ms-input-placeholder { color: #718096; }
        .light-mode .subject-input::placeholder { color: #718096; }

        .light-mode .subject-input:focus {
            border-color: #0096c7;
            -webkit-box-shadow: 0 0 5px rgba(0, 150, 199, 0.3);
            -moz-box-shadow: 0 0 5px rgba(0, 150, 199, 0.3);
            box-shadow: 0 0 5px rgba(0, 150, 199, 0.3);
        }

        .light-mode .subject-display {
            background: rgba(0, 0, 0, 0.05);
            border-color: rgba(0, 0, 0, 0.15);
            color: #2d3748;
        }

        .light-mode .time-input {
            background: rgba(0, 0, 0, 0.05);
            border-color: rgba(0, 0, 0, 0.15);
            color: #2d3748;
            color-scheme: light;
        }

        .light-mode .time-input::-webkit-calendar-picker-indicator {
            -webkit-filter: none;
            filter: none;
        }

        .light-mode .time-input:focus {
            border-color: #0096c7;
        }

        .light-mode .time-separator {
            color: #4a5568;
        }

        .light-mode .duration-display {
            color: #b7791f;
        }

        /* 右側面板 - 淺色 */
        .light-mode .countdown-box {
            background: rgba(255, 255, 255, 0.8);
            -webkit-box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            -moz-box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .light-mode .countdown-box h3 {
            color: #4a5568;
        }

        .light-mode .countdown-box.next-exam .countdown-value {
            color: #b7791f;
            text-shadow: none;
        }

        .light-mode .countdown-box.remaining .countdown-value {
            color: #c53030;
            text-shadow: none;
        }

        .light-mode .countdown-box.warning .countdown-value {
            color: #c05621;
        }

        .light-mode .countdown-box.danger .countdown-value {
            color: #c53030;
        }

        .light-mode .current-exam-info {
            color: #0077b6;
        }

        /* 輪播區 - 淺色 */
        .light-mode .carousel-container {
            background: rgba(255, 255, 255, 0.8);
            -webkit-box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            -moz-box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .light-mode .carousel-slide h3 {
            color: #c53050;
            border-bottom-color: rgba(0, 0, 0, 0.1);
        }

        .light-mode .carousel-indicators {
            background: rgba(0, 0, 0, 0.1);
        }

        .light-mode .carousel-dot {
            background: rgba(0, 0, 0, 0.2);
        }

        .light-mode .carousel-dot:hover {
            background: rgba(0, 0, 0, 0.4);
        }

        .light-mode .carousel-dot.active {
            background: #e94560;
        }

        .light-mode .carousel-nav {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(0, 0, 0, 0.2);
            color: #2d3748;
        }

        .light-mode .carousel-nav:hover {
            background: #e94560;
            border-color: #e94560;
            color: #fff;
        }

        .light-mode .carousel-timer-bar {
            background: rgba(0, 0, 0, 0.1);
        }

        /* 人數統計 - 淺色 */
        .light-mode .carousel-slide .attendance-item label,
        .light-mode .attendance-item label {
            color: #4a5568;
        }

        .light-mode .carousel-slide .attendance-input,
        .light-mode .attendance-input {
            background: rgba(0, 0, 0, 0.05);
            border-color: rgba(0, 0, 0, 0.15);
            color: #2d3748;
        }

        .light-mode .carousel-slide .attendance-input:focus,
        .light-mode .attendance-input:focus {
            border-color: #0096c7;
        }

        .light-mode .carousel-slide .attendance-input.expected,
        .light-mode .attendance-input.expected {
            border-color: rgba(0, 150, 199, 0.5);
        }

        .light-mode .carousel-slide .attendance-input.actual,
        .light-mode .attendance-input.actual {
            border-color: rgba(56, 161, 105, 0.5);
        }

        .light-mode .carousel-slide .remarks-input,
        .light-mode .remarks-input {
            background: rgba(0, 0, 0, 0.05);
            border-color: rgba(0, 0, 0, 0.15);
            color: #2d3748;
        }

        .light-mode .carousel-slide .remarks-input:focus,
        .light-mode .remarks-input:focus {
            border-color: #0096c7;
        }

        .light-mode .carousel-slide .remarks-input::-webkit-input-placeholder { color: #718096; }
        .light-mode .carousel-slide .remarks-input:-moz-placeholder { color: #718096; }
        .light-mode .carousel-slide .remarks-input::-moz-placeholder { color: #718096; }
        .light-mode .carousel-slide .remarks-input:-ms-input-placeholder { color: #718096; }
        .light-mode .carousel-slide .remarks-input::placeholder { color: #718096; }

        /* 規則區 - 淺色 */
        .light-mode .carousel-slide .rules-content {
            color: #2d3748;
        }

        .light-mode .carousel-slide .rules-content:hover {
            background: rgba(0, 0, 0, 0.03);
        }

        .light-mode .carousel-slide .rules-list li::before {
            color: #c53050;
        }

        .light-mode .carousel-slide .rules-textarea {
            background: rgba(0, 0, 0, 0.03);
            border-color: rgba(0, 0, 0, 0.15);
            color: #2d3748;
        }

        .light-mode .carousel-slide .rules-textarea:focus {
            border-color: #0096c7;
        }

        /* 底部控制區 - 淺色 */
        .light-mode .footer {
            background: rgba(255, 255, 255, 0.7);
            border-top-color: rgba(0, 0, 0, 0.1);
            -webkit-box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            -moz-box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        }

        .light-mode .status-indicator {
            color: #2d3748;
        }

        /* 按鈕 - 淺色模式微調 */
        .light-mode .btn {
            -webkit-box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            -moz-box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* 主題切換按鈕樣式 */
        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            -webkit-border-radius: 20px;
            -moz-border-radius: 20px;
            border-radius: 20px;
            padding: 6px 12px;
            cursor: pointer;
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            font-size: 1rem;
            color: #fff;
            -webkit-transition: all 0.3s ease;
            -moz-transition: all 0.3s ease;
            -o-transition: all 0.3s ease;
            transition: all 0.3s ease;
        }

        .theme-toggle > * {
            margin-right: 6px;
        }

        .theme-toggle > *:last-child {
            margin-right: 0;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            -webkit-transform: scale(1.05);
            -moz-transform: scale(1.05);
            -ms-transform: scale(1.05);
            -o-transform: scale(1.05);
            transform: scale(1.05);
        }

        .theme-toggle .theme-icon {
            font-size: 1.2rem;
            -webkit-transition: -webkit-transform 0.3s ease;
            -moz-transition: -moz-transform 0.3s ease;
            -o-transition: -o-transform 0.3s ease;
            transition: transform 0.3s ease;
        }

        .theme-toggle:hover .theme-icon {
            -webkit-transform: rotate(20deg);
            -moz-transform: rotate(20deg);
            -ms-transform: rotate(20deg);
            -o-transform: rotate(20deg);
            transform: rotate(20deg);
        }

        .light-mode .theme-toggle {
            background: rgba(0, 0, 0, 0.1);
            border-color: rgba(0, 0, 0, 0.2);
            color: #2d3748;
        }

        .light-mode .theme-toggle:hover {
            background: rgba(0, 0, 0, 0.15);
        }

        /* 時間誤差調整控制 - 淺色 */
        .light-mode .time-adjust-controls {
            background: rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(0, 0, 0, 0.12);
            -webkit-box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            -moz-box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .light-mode .time-adjust-label {
            color: #4a5568;
            font-weight: 500;
        }

        .light-mode .time-adjust-btn {
            background: #ffffff;
            border: 1px solid #cbd5e0;
            color: #2d3748;
            font-weight: 500;
            -webkit-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            -moz-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .light-mode .time-adjust-btn:hover {
            background: #edf2f7;
            border-color: #a0aec0;
            -webkit-box-shadow: 0 2px 4px rgba(0, 0, 0, 0.12);
            -moz-box-shadow: 0 2px 4px rgba(0, 0, 0, 0.12);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.12);
        }

        .light-mode .time-adjust-btn:active {
            background: #e2e8f0;
            -webkit-transform: translateY(1px);
            -moz-transform: translateY(1px);
            -ms-transform: translateY(1px);
            -o-transform: translateY(1px);
            transform: translateY(1px);
        }

        .light-mode .time-adjust-btn.reset {
            background: #fff5f5;
            border-color: #fc8181;
            color: #c53030;
        }

        .light-mode .time-adjust-btn.reset:hover {
            background: #fed7d7;
            border-color: #f56565;
        }

        .light-mode .time-offset-display {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            color: #2d3748;
            font-weight: 600;
            -webkit-box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.06);
            -moz-box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.06);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.06);
        }

        .light-mode .time-offset-display.positive {
            color: #276749;
            background: #f0fff4;
            border-color: #9ae6b4;
        }

        .light-mode .time-offset-display.negative {
            color: #c05621;
            background: #fffaf0;
            border-color: #fbd38d;
        }

        .light-mode .time-offset-display.zero {
            color: #718096;
            background: #f7fafc;
            border-color: #e2e8f0;
        }

        /* 滾動條 - 淺色 */
        .light-mode ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
        }

        .light-mode ::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
        }

        .light-mode ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        /* ===== 觸控螢幕鍵盤適應 ===== */
        
        /* 鍵盤彈出時的基本調整 */
        .keyboard-open {
            overflow: auto !important;
            height: auto !important;
            min-height: 100vh;
        }

        .keyboard-open .main-container {
            overflow: visible !important;
            height: auto !important;
            min-height: auto;
            padding-bottom: 50vh;
        }

        /* 統一輸入框焦點樣式 */
        .input-focused {
            position: relative;
            z-index: 1000;
        }

        /* 導航列 - 固定在頂部 */
        .keyboard-open .header {
            position: sticky;
            top: 0;
            z-index: 100;
        }

        /* 輸入提示框 */
        .input-hint-bar {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(233, 69, 96, 0.95);
            color: #fff;
            padding: 10px 15px;
            font-size: 0.9rem;
            z-index: 9998;
            -webkit-box-pack: justify;
            -webkit-justify-content: space-between;
            -moz-box-pack: justify;
            -ms-flex-pack: justify;
            justify-content: space-between;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
            -moz-box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
        }

        .input-hint-bar.active {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
        }

        .input-hint-bar .hint-text {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
        }

        .input-hint-bar .hint-text span {
            margin-left: 8px;
        }

        .input-hint-bar .done-btn {
            background: #fff;
            color: #e94560;
            border: none;
            padding: 8px 20px;
            -webkit-border-radius: 20px;
            -moz-border-radius: 20px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .input-hint-bar .done-btn:hover {
            background: #f0f0f0;
        }

        /* 輸入區域的輔助框 */
        .input-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .input-overlay.active {
            display: block;
        }

        /* 浮動輸入區域 */
        .floating-input-container {
            display: none;
            position: fixed;
            top: 60px;
            left: 10px;
            right: 10px;
            max-height: calc(40vh - 60px);
            background: #1a1a2e;
            -webkit-border-radius: 12px;
            -moz-border-radius: 12px;
            border-radius: 12px;
            z-index: 1001;
            -webkit-box-shadow: 0 5px 30px rgba(0, 0, 0, 0.5);
            -moz-box-shadow: 0 5px 30px rgba(0, 0, 0, 0.5);
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            -moz-box-orient: vertical;
            -moz-box-direction: normal;
            -ms-flex-direction: column;
            flex-direction: column;
        }

        .floating-input-container.active {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
        }

        .floating-input-header {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: justify;
            -webkit-justify-content: space-between;
            -moz-box-pack: justify;
            -ms-flex-pack: justify;
            justify-content: space-between;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            padding: 12px 15px;
            background: rgba(233, 69, 96, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .floating-input-header .title {
            font-weight: bold;
            color: #e94560;
            font-size: 1rem;
        }

        .floating-input-header .close-btn {
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            width: 32px;
            height: 32px;
            -webkit-border-radius: 50%;
            -moz-border-radius: 50%;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            -moz-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            -webkit-transition: all 0.2s ease;
            -moz-transition: all 0.2s ease;
            -o-transition: all 0.2s ease;
            transition: all 0.2s ease;
        }

        .floating-input-header .close-btn:hover {
            background: #e94560;
            border-color: #e94560;
        }

        .floating-input-body {
            padding: 15px;
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            -moz-box-flex: 1;
            -ms-flex: 1;
            flex: 1;
            overflow: auto;
        }

        .floating-input-body input,
        .floating-input-body textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            -webkit-border-radius: 8px;
            -moz-border-radius: 8px;
            border-radius: 8px;
            padding: 12px 15px;
            color: #fff;
            font-size: 1.1rem;
        }

        .floating-input-body input:focus,
        .floating-input-body textarea:focus {
            outline: none;
            border-color: #00d9ff;
        }

        .floating-input-body textarea {
            min-height: 100px;
            resize: none;
        }

        /* 淺色模式 */
        .light-mode .floating-input-container {
            background: #fff;
            -webkit-box-shadow: 0 5px 30px rgba(0, 0, 0, 0.2);
            -moz-box-shadow: 0 5px 30px rgba(0, 0, 0, 0.2);
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.2);
        }

        .light-mode .floating-input-header {
            background: rgba(233, 69, 96, 0.1);
            border-bottom-color: rgba(0, 0, 0, 0.1);
        }

        .light-mode .floating-input-header .title {
            color: #c53050;
        }

        .light-mode .floating-input-header .close-btn {
            border-color: rgba(0, 0, 0, 0.2);
            color: #333;
        }

        .light-mode .floating-input-body input,
        .light-mode .floating-input-body textarea {
            background: rgba(0, 0, 0, 0.05);
            border-color: rgba(0, 0, 0, 0.15);
            color: #333;
        }

        .light-mode .input-hint-bar {
            background: rgba(197, 48, 80, 0.95);
        }

        /* 考試結束提醒視窗 */
        .exam-end-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 9999;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            -moz-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -moz-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            -moz-box-orient: vertical;
            -moz-box-direction: normal;
            -ms-flex-direction: column;
            flex-direction: column;
        }

        .exam-end-overlay.active {
            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
        }

        .exam-end-content {
            text-align: center;
            padding: 60px 80px;
            background: linear-gradient(135deg, #c53050 0%, #e94560 50%, #ff6b7a 100%);
            -webkit-border-radius: 20px;
            -moz-border-radius: 20px;
            border-radius: 20px;
            -webkit-box-shadow: 0 0 60px rgba(233, 69, 96, 0.8), 0 0 100px rgba(233, 69, 96, 0.4);
            -moz-box-shadow: 0 0 60px rgba(233, 69, 96, 0.8), 0 0 100px rgba(233, 69, 96, 0.4);
            box-shadow: 0 0 60px rgba(233, 69, 96, 0.8), 0 0 100px rgba(233, 69, 96, 0.4);
            -webkit-animation: pulseGlow 1s ease-in-out infinite;
            -moz-animation: pulseGlow 1s ease-in-out infinite;
            -o-animation: pulseGlow 1s ease-in-out infinite;
            animation: pulseGlow 1s ease-in-out infinite;
        }

        @-webkit-keyframes pulseGlow {
            0%, 100% { -webkit-transform: scale(1); transform: scale(1); }
            50% { -webkit-transform: scale(1.02); transform: scale(1.02); }
        }

        @-moz-keyframes pulseGlow {
            0%, 100% { -moz-transform: scale(1); transform: scale(1); }
            50% { -moz-transform: scale(1.02); transform: scale(1.02); }
        }

        @-o-keyframes pulseGlow {
            0%, 100% { -o-transform: scale(1); transform: scale(1); }
            50% { -o-transform: scale(1.02); transform: scale(1.02); }
        }

        @keyframes pulseGlow {
            0%, 100% { -webkit-transform: scale(1); -moz-transform: scale(1); -o-transform: scale(1); transform: scale(1); }
            50% { -webkit-transform: scale(1.02); -moz-transform: scale(1.02); -o-transform: scale(1.02); transform: scale(1.02); }
        }

        .exam-end-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            -webkit-animation: shake 0.5s ease-in-out infinite;
            -moz-animation: shake 0.5s ease-in-out infinite;
            -o-animation: shake 0.5s ease-in-out infinite;
            animation: shake 0.5s ease-in-out infinite;
        }

        @-webkit-keyframes shake {
            0%, 100% { -webkit-transform: rotate(-5deg); transform: rotate(-5deg); }
            50% { -webkit-transform: rotate(5deg); transform: rotate(5deg); }
        }

        @-moz-keyframes shake {
            0%, 100% { -moz-transform: rotate(-5deg); transform: rotate(-5deg); }
            50% { -moz-transform: rotate(5deg); transform: rotate(5deg); }
        }

        @-o-keyframes shake {
            0%, 100% { -o-transform: rotate(-5deg); transform: rotate(-5deg); }
            50% { -o-transform: rotate(5deg); transform: rotate(5deg); }
        }

        @keyframes shake {
            0%, 100% { -webkit-transform: rotate(-5deg); -moz-transform: rotate(-5deg); -o-transform: rotate(-5deg); transform: rotate(-5deg); }
            50% { -webkit-transform: rotate(5deg); -moz-transform: rotate(5deg); -o-transform: rotate(5deg); transform: rotate(5deg); }
        }

        .exam-end-title {
            font-size: 4rem;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            margin-bottom: 15px;
            letter-spacing: 0.2em;
        }

        .exam-end-subtitle {
            font-size: 2.5rem;
            color: #fff;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
        }

        .exam-end-timer {
            font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 20px;
        }

        .exam-end-timer span {
            font-weight: bold;
            font-size: 2rem;
            color: #fff;
        }

    </style>
</head>
<body>
    <!-- 頂部標題區 -->
    <header class="header">
        <div>
            <h1>📋 考試時間表</h1>
        </div>
        <div style="text-align: center;">
            <div class="current-time" id="currentTime">00:00:00</div>
            <div class="current-date" id="currentDate">2026年1月19日 星期一</div>
        </div>
        <div style="text-align: right; display: -webkit-box; display: -webkit-flex; display: -moz-box; display: -ms-flexbox; display: flex; -webkit-box-align: center; -webkit-align-items: center; -moz-box-align: center; -ms-flex-align: center; align-items: center;">
            <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="切換深色/淺色模式">
                <span class="theme-icon" id="themeIcon">🌙</span>
                <span id="themeText">深色</span>
            </button>
            <button class="btn btn-warning" id="toggleFooterBtn" onclick="toggleFooter()" title="隱藏/顯示控制面板" style="margin-left: 10px;">⚙️ 設定</button>
            <button class="btn btn-primary" id="fullscreenBtn" onclick="toggleFullscreen()" title="切換全螢幕模式" style="margin-left: 10px;">⛶ 全螢幕</button>
        </div>
    </header>

    <!-- 主要內容區 -->
    <main class="main-container">
        <!-- 左側：考試節次列表 -->
        <section class="schedule-panel" id="schedulePanel">
            <button class="panel-toggle" onclick="toggleSchedulePanel()" title="收納/展開考試科目欄">◀</button>
            <span class="collapsed-label">📋 考試節次</span>
            <div class="schedule-header">
                <span>節次</span>
                <span>考試科目</span>
                <span>考試時間</span>
                <span>時長</span>
            </div>
            <div class="schedule-list" id="scheduleList">
                <!-- 動態生成 -->
            </div>
        </section>

        <!-- 右側面板 -->
        <aside class="right-panel">
            <!-- 倒數計時區 -->
            <div class="countdown-section">
                <div class="countdown-box next-exam">
                    <h3 id="nextExamTitle">📍 距離下一節考試</h3>
                    <div class="countdown-value" id="nextExamCountdown">--:--:--</div>
                    <div class="current-exam-info" id="nextExamInfo">尚未設定考試時間</div>
                </div>
                <div class="countdown-box remaining">
                    <h3 id="remainingTitle">⏱️ 本節剩餘時間</h3>
                    <div class="countdown-value" id="remainingTime">--:--:--</div>
                    <div class="current-exam-info" id="currentExamInfo">目前無進行中的考試</div>
                </div>
            </div>

            <!-- 輪播區：人數統計 + 考試規則 -->
            <div class="carousel-container" id="infoCarousel">
                <div class="carousel-timer-bar">
                    <div class="carousel-timer-progress" id="carouselProgress"></div>
                </div>
                
                <div class="carousel-slides" id="carouselSlides">
                    <!-- 第一頁：人數統計 -->
                    <div class="carousel-slide" id="slide-attendance">
                        <div class="carousel-header">
                            <h3>👥 人數統計</h3>
                            <div class="zoom-controls">
                                <span class="zoom-label">備註</span>
                                <button class="zoom-btn" onclick="zoomText('remarks', -1)" title="縮小備註文字">−</button>
                                <span class="zoom-level" id="remarks-zoom-level">100%</span>
                                <button class="zoom-btn" onclick="zoomText('remarks', 1)" title="放大備註文字">+</button>
                            </div>
                            <div class="carousel-header-spacer"></div>
                            <div class="carousel-controls">
                                <div class="carousel-indicators">
                                    <div class="carousel-dot active" onclick="goToSlide(0)" title="人數統計"></div>
                                    <div class="carousel-dot" onclick="goToSlide(1)" title="考試規則"></div>
                                </div>
                                <button class="carousel-nav prev" onclick="prevSlide()">❮</button>
                                <button class="carousel-nav next" onclick="nextSlide()">❯</button>
                            </div>
                        </div>
                        <div class="attendance-grid">
                            <div class="attendance-item">
                                <label>應到人數</label>
                                <input type="number" class="attendance-input expected" id="expectedCount" value="0" min="0">
                            </div>
                            <div class="attendance-item">
                                <label>實到人數</label>
                                <input type="number" class="attendance-input actual" id="actualCount" value="0" min="0">
                            </div>
                            <div class="attendance-item">
                                <label>缺席人數</label>
                                <input type="number" class="attendance-input" id="absentCount" value="0" readonly style="background: rgba(244, 67, 54, 0.2); border-color: rgba(244, 67, 54, 0.5);">
                            </div>
                        </div>
                        <textarea class="remarks-input" id="remarks" placeholder="備註事項（如：特殊情況、違規紀錄等）"></textarea>
                    </div>
                    
                    <!-- 第二頁：考試規則 -->
                    <div class="carousel-slide" id="slide-rules">
                        <div class="carousel-header">
                            <h3>📜 考試規則</h3>
                            <div class="zoom-controls">
                                <span class="zoom-label">規則</span>
                                <button class="zoom-btn" onclick="zoomText('rules', -1)" title="縮小規則文字">−</button>
                                <span class="zoom-level" id="rules-zoom-level">100%</span>
                                <button class="zoom-btn" onclick="zoomText('rules', 1)" title="放大規則文字">+</button>
                            </div>
                            <div class="carousel-header-spacer"></div>
                            <div class="carousel-controls">
                                <div class="carousel-indicators">
                                    <div class="carousel-dot" onclick="goToSlide(0)" title="人數統計"></div>
                                    <div class="carousel-dot active" onclick="goToSlide(1)" title="考試規則"></div>
                                </div>
                                <button class="carousel-nav prev" onclick="prevSlide()">❮</button>
                                <button class="carousel-nav next" onclick="nextSlide()">❯</button>
                            </div>
                        </div>
                        <div class="rules-content" id="rulesContent" ondblclick="toggleRulesEdit()">
                            <ul class="rules-list" id="rulesList">
                                <li>考生應於預備鐘響時準時進入試場</li>
                                <li>作答時不得交談、窺視他人答案</li>
                                <li>考試時間不得交換文具、紙張</li>
                                <li>違規者依校規處理，情節嚴重者該科以零分計算</li>
                                <li>寫完考卷時，請至少詳細檢查一次</li>
                            </ul>
                        </div>
                        <textarea class="rules-textarea" id="rulesTextarea" onblur="saveRulesEdit()"></textarea>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <!-- 底部控制區 -->
    <footer class="footer">
        <div class="control-buttons">
            <button class="btn btn-success" onclick="saveData()">💾 儲存資料</button>
            <button class="btn btn-warning" onclick="loadData()">📂 載入資料</button>
            <button class="btn btn-danger" onclick="clearData()">🗑️ 清除資料</button>
        </div>
        <div class="time-adjust-controls">
            <span class="time-adjust-label">⏰ 時間誤差調整：</span>
            <button class="time-adjust-btn" onclick="adjustTimeOffset(-60)" title="減少 1 分鐘">-1分</button>
            <button class="time-adjust-btn" onclick="adjustTimeOffset(-10)" title="減少 10 秒">-10秒</button>
            <button class="time-adjust-btn" onclick="adjustTimeOffset(-1)" title="減少 1 秒">-1秒</button>
            <span class="time-offset-display" id="timeOffsetDisplay">0 秒</span>
            <button class="time-adjust-btn" onclick="adjustTimeOffset(1)" title="增加 1 秒">+1秒</button>
            <button class="time-adjust-btn" onclick="adjustTimeOffset(10)" title="增加 10 秒">+10秒</button>
            <button class="time-adjust-btn" onclick="adjustTimeOffset(60)" title="增加 1 分鐘">+1分</button>
            <button class="time-adjust-btn reset" onclick="resetTimeOffset()" title="重置為 0">重置</button>
        </div>
        <div class="status-indicator">
            <span class="status-dot"></span>
            <span>系統運行中</span>
        </div>
    </footer>

    <!-- 浮動輸入區域遮罩 -->
    <!-- 考試結束提醒視窗 -->
    <div class="exam-end-overlay" id="examEndOverlay">
        <div class="exam-end-content">
            <div class="exam-end-icon">🔔</div>
            <div class="exam-end-title">考試結束</div>
            <div class="exam-end-subtitle">請考生停筆</div>
            <div class="exam-end-timer">此提示將在 <span id="examEndCountdown">10</span> 秒後自動關閉</div>
        </div>
    </div>

    <div class="input-overlay" id="inputOverlay" onclick="closeFloatingInput()"></div>
    
    <!-- 浮動輸入區域 -->
    <div class="floating-input-container" id="floatingInputContainer">
        <div class="floating-input-header">
            <span class="title" id="floatingInputTitle">輸入</span>
            <button class="close-btn" onclick="closeFloatingInput()" title="完成">✕</button>
        </div>
        <div class="floating-input-body" id="floatingInputBody">
            <!-- 動態插入輸入框 -->
        </div>
    </div>

    <!-- 輸入提示列 -->
    <div class="input-hint-bar" id="inputHintBar">
        <div class="hint-text">
            <span>⌨️</span>
            <span id="inputHintText">正在輸入...</span>
        </div>
        <button class="done-btn" onclick="closeFloatingInput()">完成</button>
    </div>

    <script>
        // ===== Polyfill for String.prototype.padStart =====
        if (!String.prototype.padStart) {
            String.prototype.padStart = function padStart(targetLength, padString) {
                targetLength = targetLength >> 0;
                padString = String(typeof padString !== 'undefined' ? padString : ' ');
                if (this.length >= targetLength) {
                    return String(this);
                }
                targetLength = targetLength - this.length;
                if (targetLength > padString.length) {
                    padString += padString.repeat(targetLength / padString.length);
                }
                return padString.slice(0, targetLength) + String(this);
            };
        }

        // ===== Polyfill for String.prototype.repeat =====
        if (!String.prototype.repeat) {
            String.prototype.repeat = function(count) {
                if (this == null) throw new TypeError('can\'t convert ' + this + ' to object');
                var str = '' + this;
                count = +count;
                if (count < 0) throw new RangeError('repeat count must be non-negative');
                if (count == Infinity) throw new RangeError('repeat count must be less than infinity');
                count = Math.floor(count);
                if (str.length == 0 || count == 0) return '';
                var rpt = '';
                for (var i = 0; i < count; i++) {
                    rpt += str;
                }
                return rpt;
            };
        }

        // ===== Polyfill for Array.prototype.some =====
        if (!Array.prototype.some) {
            Array.prototype.some = function(fun) {
                if (this == null) throw new TypeError('Array.prototype.some called on null or undefined');
                if (typeof fun !== 'function') throw new TypeError();
                var t = Object(this);
                var len = t.length >>> 0;
                var thisArg = arguments.length >= 2 ? arguments[1] : void 0;
                for (var i = 0; i < len; i++) {
                    if (i in t && fun.call(thisArg, t[i], i, t)) return true;
                }
                return false;
            };
        }

        // ===== Polyfill for String.prototype.includes =====
        if (!String.prototype.includes) {
            String.prototype.includes = function(search, start) {
                if (typeof start !== 'number') start = 0;
                if (start + search.length > this.length) return false;
                return this.indexOf(search, start) !== -1;
            };
        }

        // ===== Polyfill for Array.prototype.find =====
        if (!Array.prototype.find) {
            Array.prototype.find = function(predicate) {
                if (this == null) throw new TypeError('Array.prototype.find called on null or undefined');
                if (typeof predicate !== 'function') throw new TypeError('predicate must be a function');
                var list = Object(this);
                var length = list.length >>> 0;
                var thisArg = arguments[1];
                for (var i = 0; i < length; i++) {
                    var value = list[i];
                    if (predicate.call(thisArg, value, i, list)) return value;
                }
                return undefined;
            };
        }

        // ===== Polyfill for Element.prototype.closest =====
        if (!Element.prototype.closest) {
            Element.prototype.closest = function(s) {
                var el = this;
                do {
                    if (el.matches(s)) return el;
                    el = el.parentElement || el.parentNode;
                } while (el !== null && el.nodeType === 1);
                return null;
            };
        }

        // ===== Polyfill for Element.prototype.matches =====
        if (!Element.prototype.matches) {
            Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;
        }

        // 節次資料（含預設考試時間）
        // type: 'exam' 為考試節次, 'morning' 為早自習, 'lunch' 為午休
        var periods = [
            { id: 'morning', label: '早自習', defaultStart: '07:30', defaultEnd: '08:00', type: 'morning' },
            { id: 1, label: '第一節', defaultStart: '08:15', defaultEnd: '09:00', type: 'exam' },
            { id: 2, label: '第二節', defaultStart: '09:15', defaultEnd: '10:00', type: 'exam' },
            { id: 3, label: '第三節', defaultStart: '10:15', defaultEnd: '11:00', type: 'exam' },
            { id: 4, label: '第四節', defaultStart: '11:10', defaultEnd: '11:55', type: 'exam' },
            { id: 'lunch', label: '午休', defaultStart: '12:40', defaultEnd: '13:05', type: 'lunch' },
            { id: 5, label: '第五節', defaultStart: '13:15', defaultEnd: '14:00', type: 'exam' },
            { id: 6, label: '第六節', defaultStart: '14:15', defaultEnd: '15:00', type: 'exam' },
            { id: 7, label: '第七節', defaultStart: '15:20', defaultEnd: '16:05', type: 'exam' }
        ];

        // 初始化節次列表
        function initScheduleList() {
            var scheduleList = document.getElementById('scheduleList');
            var html = '';
            for (var i = 0; i < periods.length; i++) {
                var period = periods[i];
                var periodIdStr = String(period.id);
                var isExam = period.type === 'exam';
                var isMorning = period.type === 'morning';
                var isLunch = period.type === 'lunch';
                var itemClass = 'schedule-item';
                if (isMorning) itemClass += ' morning-period';
                if (isLunch) itemClass += ' lunch-period';
                
                html += '<div class="' + itemClass + '" id="period-' + periodIdStr + '" data-period="' + periodIdStr + '" data-type="' + period.type + '">';
                html += '<span class="period-label">' + period.label + '</span>';
                
                if (isExam) {
                    // 考試節次：顯示科目輸入欄
                    html += '<div class="subject-wrapper">' +
                        '<input type="text" class="subject-input" ' +
                            'id="subject-' + periodIdStr + '" ' +
                            'placeholder="考試科目" ' +
                            'oninput="saveToLocalStorage()" ' +
                            'onchange="saveToLocalStorage()" ' +
                            'onfocus="hideSubjectDisplay(\'' + periodIdStr + '\')" ' +
                            'onblur="updateSubjectDisplay(\'' + periodIdStr + '\')">' +
                        '<div class="subject-display" id="subject-display-' + periodIdStr + '" onclick="editSubject(\'' + periodIdStr + '\')">' +
                            '<span class="marquee-text" id="marquee-' + periodIdStr + '"></span>' +
                        '</div>' +
                    '</div>';
                } else if (isMorning) {
                    // 早自習：顯示固定文字
                    html += '<div class="non-exam-label"><span class="non-exam-text">📖 早自習時間</span></div>';
                } else if (isLunch) {
                    // 午休：顯示固定文字
                    html += '<div class="non-exam-label"><span class="non-exam-text">😴 午休時間</span></div>';
                }
                
                html += '<div class="time-inputs">' +
                    '<input type="time" class="time-input" ' +
                        'id="start-' + periodIdStr + '" ' +
                        'onchange="updateDuration(\'' + periodIdStr + '\'); saveToLocalStorage()">' +
                    '<span class="time-separator">~</span>' +
                    '<input type="time" class="time-input" ' +
                        'id="end-' + periodIdStr + '" ' +
                        'onchange="updateDuration(\'' + periodIdStr + '\'); saveToLocalStorage()">' +
                '</div>';
                html += '<span class="duration-display" id="duration-' + periodIdStr + '">--分</span>';
                html += '</div>';
            }
            scheduleList.innerHTML = html;
        }

        // 隱藏科目顯示區（進入編輯模式）
        function hideSubjectDisplay(periodId) {
            var display = document.getElementById('subject-display-' + periodId);
            if (display) {
                display.classList.remove('active');
            }
        }

        // 更新科目顯示（跑馬燈）
        function updateSubjectDisplay(periodId) {
            var input = document.getElementById('subject-' + periodId);
            var display = document.getElementById('subject-display-' + periodId);
            var marquee = document.getElementById('marquee-' + periodId);

            // 容錯檢查
            if (!input || !display || !marquee) return;

            var text = (input.value || '').trim();

            // 除錯輸出，瀏覽器 console 可查看
            console.debug('updateSubjectDisplay', periodId, text);

            if (text) {
                if (text.length > 6) {
                    // 文字超過6個字，顯示跑馬燈
                    marquee.textContent = text + '　　　　' + text + '　　　　';
                    marquee.classList.add('animate');
                } else {
                    // 文字短，不需要跑馬燈，靜態顯示
                    marquee.textContent = text;
                    marquee.classList.remove('animate');
                }

                // 顯示 display 區塊，隱藏 input
                display.classList.add('active');
                input.classList.add('hidden');
            } else {
                // 沒有文字，顯示輸入框，隱藏 display
                display.classList.remove('active');
                marquee.textContent = '';
                marquee.classList.remove('animate');
                input.classList.remove('hidden');
            }
        }

        // 點擊顯示區域進入編輯模式
        function editSubject(periodId) {
            var input = document.getElementById('subject-' + periodId);
            var display = document.getElementById('subject-display-' + periodId);
            if (!input || !display) return;

            display.classList.remove('active');
            input.classList.remove('hidden');
            input.focus();
            input.select();
        }

        // 計算並顯示考試時長
        function updateDuration(periodId) {
            var startInput = document.getElementById('start-' + periodId);
            var endInput = document.getElementById('end-' + periodId);
            var durationDisplay = document.getElementById('duration-' + periodId);
            
            if (startInput.value && endInput.value) {
                var start = timeToMinutes(startInput.value);
                var end = timeToMinutes(endInput.value);
                var duration = end - start;
                
                if (duration > 0) {
                    durationDisplay.textContent = duration + '分鐘';
                } else {
                    durationDisplay.textContent = '時間錯誤';
                }
            } else {
                durationDisplay.textContent = '--分鐘';
            }
        }

        // 時間轉分鐘
        function timeToMinutes(timeStr) {
            var parts = timeStr.split(':');
            var hours = parseInt(parts[0], 10);
            var minutes = parseInt(parts[1], 10);
            return hours * 60 + minutes;
        }

        // 時間偏移量（秒），用於調整學校時鐘與網際時間的誤差
        var timeOffsetSeconds = parseInt(localStorage.getItem('examTimeOffset')) || 0;

        // 調整時間偏移
        function adjustTimeOffset(seconds) {
            timeOffsetSeconds += seconds;
            localStorage.setItem('examTimeOffset', timeOffsetSeconds);
            updateTimeOffsetDisplay();
            updateCurrentTime();
        }

        // 重置時間偏移
        function resetTimeOffset() {
            timeOffsetSeconds = 0;
            localStorage.setItem('examTimeOffset', 0);
            updateTimeOffsetDisplay();
            updateCurrentTime();
        }

        // 更新時間偏移顯示
        function updateTimeOffsetDisplay() {
            var display = document.getElementById('timeOffsetDisplay');
            if (display) {
                var absSeconds = Math.abs(timeOffsetSeconds);
                var sign = timeOffsetSeconds >= 0 ? '+' : '-';
                if (absSeconds >= 60) {
                    var mins = Math.floor(absSeconds / 60);
                    var secs = absSeconds % 60;
                    display.textContent = sign + mins + '分' + secs + '秒';
                } else {
                    display.textContent = sign + absSeconds + ' 秒';
                }
                // 根據偏移方向變色
                display.classList.remove('positive', 'negative', 'zero');
                if (timeOffsetSeconds > 0) {
                    display.classList.add('positive');
                } else if (timeOffsetSeconds < 0) {
                    display.classList.add('negative');
                } else {
                    display.classList.add('zero');
                }
            }
        }

        // 更新當前時間
        function updateCurrentTime() {
            var realNow = new Date();
            // 加上偏移量
            var now = new Date(realNow.getTime() + timeOffsetSeconds * 1000);
            var timeStr = now.toLocaleTimeString('zh-TW', { hour12: false });
            var dateStr = now.toLocaleDateString('zh-TW', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            
            document.getElementById('currentTime').textContent = timeStr;
            document.getElementById('currentDate').textContent = dateStr;
            
            updateCountdowns(now);
            updatePeriodStatus(now);
        }

        // 追蹤考試結束狀態，避免重複顯示提醒
        var examEndShownFor = null;
        var examEndTimer = null;

        // 顯示考試結束提醒視窗
        function showExamEndAlert() {
            var overlay = document.getElementById('examEndOverlay');
            var countdownEl = document.getElementById('examEndCountdown');
            overlay.classList.add('active');
            
            var countdown = 10;
            countdownEl.textContent = countdown;
            
            if (examEndTimer) {
                clearInterval(examEndTimer);
            }
            
            examEndTimer = setInterval(function() {
                countdown--;
                countdownEl.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(examEndTimer);
                    examEndTimer = null;
                    overlay.classList.remove('active');
                }
            }, 1000);
        }

        // 更新倒數計時
        function updateCountdowns(now) {
            var currentMinutes = now.getHours() * 60 + now.getMinutes();
            var currentSeconds = now.getSeconds();
            var currentTotalSeconds = currentMinutes * 60 + currentSeconds;
            
            var nextExam = null;
            var nextPeriod = null; // 下一節課（包含自習）
            var currentExam = null;
            
            // 找出下一節考試和當前考試
            for (var i = 0; i < periods.length; i++) {
                var period = periods[i];
                var startInput = document.getElementById('start-' + period.id);
                var endInput = document.getElementById('end-' + period.id);
                var subjectInput = document.getElementById('subject-' + period.id);
                
                if (startInput && startInput.value && endInput && endInput.value) {
                    var startMinutes = timeToMinutes(startInput.value);
                    var endMinutes = timeToMinutes(endInput.value);
                    var subjectName = subjectInput ? subjectInput.value : '';
                    
                    // 判斷是否為非考試時段（早自習或午休）
                    var isNonExamPeriod = period.type === 'morning' || period.type === 'lunch';
                    
                    // 檢查是否為當前節次
                    if (currentMinutes >= startMinutes && currentMinutes < endMinutes) {
                        currentExam = {
                            period: period,
                            subject: isNonExamPeriod ? period.label : (subjectName || '未設定科目'),
                            endMinutes: endMinutes,
                            startMinutes: startMinutes,
                            isSelfStudy: isNonExamPeriod || isSelfStudySubject(subjectName)
                        };
                    }
                    
                    // 找出下一節課（包含所有類型，用於計算下課時間）
                    if (startMinutes > currentMinutes && !nextPeriod) {
                        nextPeriod = {
                            period: period,
                            subject: isNonExamPeriod ? period.label : (subjectName || '未設定科目'),
                            startMinutes: startMinutes,
                            isSelfStudy: isNonExamPeriod || isSelfStudySubject(subjectName)
                        };
                    }
                    
                    // 檢查是否為下一節考試（跳過自習類科目和非考試時段）
                    if (startMinutes > currentMinutes && !nextExam && !isNonExamPeriod && !isSelfStudySubject(subjectName)) {
                        nextExam = {
                            period: period,
                            subject: subjectName || '未設定科目',
                            startMinutes: startMinutes
                        };
                    }
                    
                    // 檢查是否剛結束考試（非自習類，非早自習午休）
                    // 在結束時間的第一秒觸發提醒
                    if (currentMinutes === endMinutes && currentSeconds === 0 && !isNonExamPeriod && !isSelfStudySubject(subjectName)) {
                        var examKey = period.id + '-' + endMinutes;
                        if (examEndShownFor !== examKey) {
                            examEndShownFor = examKey;
                            showExamEndAlert();
                        }
                    }
                }
            }
            
            // 取得倒數計時區域元素
            var nextExamBox = document.getElementById('nextExamCountdown').closest('.countdown-box');
            var remainingBox = document.getElementById('remainingTime').closest('.countdown-box');
            var nextExamCountdown = document.getElementById('nextExamCountdown');
            var nextExamInfo = document.getElementById('nextExamInfo');
            var nextExamTitle = document.getElementById('nextExamTitle');
            var remainingTime = document.getElementById('remainingTime');
            var currentExamInfo = document.getElementById('currentExamInfo');
            var remainingTitle = document.getElementById('remainingTitle');
            
            remainingBox.classList.remove('warning', 'danger');
            
            // 判斷顯示邏輯
            if (currentExam && currentExam.isSelfStudy) {
                // 當節是自習/早自習/午休，根據類型顯示不同內容
                var isMorningPeriod = currentExam.period.type === 'morning';
                var isLunchPeriod = currentExam.period.type === 'lunch';
                
                // 顯示兩個區塊：當前時段剩餘時間 + 距離下一節考試
                nextExamBox.style.display = 'block';
                remainingBox.style.display = 'block';
                nextExamBox.style.flex = '1';
                remainingBox.style.flex = '1';
                nextExamBox.style.width = '';
                remainingBox.style.width = '';
                nextExamBox.style.marginRight = '';
                remainingBox.style.marginRight = '0';
                
                // 更新當前時段剩餘時間
                var diffSeconds2 = currentExam.endMinutes * 60 - currentTotalSeconds;
                remainingTime.textContent = formatCountdown(diffSeconds2);
                
                if (isMorningPeriod) {
                    remainingTitle.textContent = '📖 早自習剩餘時間';
                    currentExamInfo.textContent = '請把握時間複習';
                } else if (isLunchPeriod) {
                    remainingTitle.textContent = '😴 午休剩餘時間';
                    currentExamInfo.textContent = '請好好休息';
                } else {
                    remainingTitle.textContent = '📚 自習剩餘時間';
                    currentExamInfo.textContent = currentExam.period.label + '：' + currentExam.subject;
                }
                currentExamInfo.classList.add('multiline');
                
                // 更新距離下一節考試
                if (nextExam) {
                    var diffSeconds = nextExam.startMinutes * 60 - currentTotalSeconds;
                    nextExamCountdown.textContent = formatCountdown(diffSeconds);
                    // 判斷是否在預備鐘時間內
                    if (diffSeconds <= 180 && diffSeconds > 0) {
                        nextExamTitle.textContent = '🔔 預備鐘倒數';
                        nextExamInfo.innerHTML = nextExam.period.label + '：' + nextExam.subject + '<br>即將開始';
                        nextExamInfo.classList.add('multiline');
                        nextExamBox.classList.add('warning');
                    } else {
                        nextExamTitle.textContent = '📍 距離下一節考試';
                        nextExamInfo.textContent = nextExam.period.label + '：' + nextExam.subject;
                        nextExamInfo.classList.add('multiline');
                        nextExamBox.classList.remove('warning');
                    }
                } else {
                    nextExamCountdown.textContent = '--:--:--';
                    nextExamTitle.textContent = '📍 距離下一節考試';
                    nextExamInfo.textContent = '今日考試已結束';
                    nextExamInfo.classList.add('multiline');
                    nextExamBox.classList.remove('warning');
                }
            } else if (currentExam && !currentExam.isSelfStudy) {
                // 當節是真正的考試，隱藏「距離下一節考試」，只顯示「本節剩餘時間」
                nextExamBox.style.display = 'none';
                remainingBox.style.display = 'block';
                remainingBox.style.flex = '1';
                remainingBox.style.width = '100%';
                remainingBox.style.marginRight = '0';
                
                remainingTitle.textContent = '⏱️ 本節剩餘時間';
                var diffMinutes = currentExam.endMinutes - currentMinutes;
                var diffSeconds2 = currentExam.endMinutes * 60 - currentTotalSeconds;
                remainingTime.textContent = formatCountdown(diffSeconds2);
                currentExamInfo.textContent = currentExam.period.label + '：' + currentExam.subject;
                currentExamInfo.classList.add('multiline');
                
                // 根據剩餘時間變更顏色
                if (diffMinutes <= 5) {
                    remainingBox.classList.add('danger');
                } else if (diffMinutes <= 15) {
                    remainingBox.classList.add('warning');
                }
            } else {
                // 沒有任何進行中的節次（下課時間）
                // 顯示兩個區塊：距離下一節考試 + 下課時間倒數
                nextExamBox.style.display = 'block';
                remainingBox.style.display = 'block';
                nextExamBox.style.flex = '1';
                remainingBox.style.flex = '1';
                nextExamBox.style.width = '';
                remainingBox.style.width = '';
                nextExamBox.style.marginRight = '';
                remainingBox.style.marginRight = '0';
                
                // 更新「距離下一節考試」
                if (nextExam) {
                    var diffSeconds3 = nextExam.startMinutes * 60 - currentTotalSeconds;
                    nextExamCountdown.textContent = formatCountdown(diffSeconds3);
                    // 判斷是否在預備鐘時間內
                    if (diffSeconds3 <= 180 && diffSeconds3 > 0) {
                        nextExamTitle.textContent = '🔔 預備鐘倒數';
                        nextExamInfo.innerHTML = nextExam.period.label + '：' + nextExam.subject + '<br>即將開始';
                        nextExamInfo.classList.add('multiline');
                        nextExamBox.classList.add('warning');
                    } else {
                        nextExamTitle.textContent = '📍 距離下一節考試';
                        nextExamInfo.textContent = nextExam.period.label + '：' + nextExam.subject;
                        nextExamInfo.classList.add('multiline');
                        nextExamBox.classList.remove('warning');
                    }
                } else {
                    nextExamCountdown.textContent = '--:--:--';
                    nextExamTitle.textContent = '📍 距離下一節考試';
                    nextExamInfo.textContent = '今日考試已結束';
                    nextExamInfo.classList.add('multiline');
                    nextExamBox.classList.remove('warning');
                }
                
                // 更新「下課時間倒數」（減掉3分鐘預備鐘時間）
                // 判斷是否為用餐時間（第四節結束到午休開始）
                var isLunchBreak = nextPeriod && nextPeriod.period.type === 'lunch';
                
                if (isLunchBreak) {
                    remainingTitle.textContent = '🍱 用餐時間倒數';
                } else {
                    remainingTitle.textContent = '☕ 下課時間倒數';
                }
                
                if (nextPeriod) {
                    // 下課時間 = 距離下一節開始的時間 - 3分鐘預備鐘時間
                    // 用餐時間不扣除預備鐘時間
                    var prepBellTime = isLunchBreak ? 0 : 180;
                    var breakTimeSeconds = nextPeriod.startMinutes * 60 - currentTotalSeconds - prepBellTime;
                    if (breakTimeSeconds > 0) {
                        remainingTime.textContent = formatCountdown(breakTimeSeconds);
                        if (isLunchBreak) {
                            currentExamInfo.textContent = '請把握時間用餐';
                        } else {
                            currentExamInfo.textContent = '距離預備鐘響起';
                        }
                        currentExamInfo.classList.add('multiline');
                        
                        // 下課時間剩餘不到1分鐘時變色提醒
                        if (breakTimeSeconds <= 60) {
                            remainingBox.classList.add('warning');
                        }
                    } else {
                        // 已經是預備鐘時間了
                        remainingTime.textContent = '00:00:00';
                        // 根據下一節是否為自習課顯示不同文字
                        if (nextPeriod.isSelfStudy) {
                            currentExamInfo.innerHTML = '預備鐘已響<br>請準備複習考試';
                        } else {
                            currentExamInfo.innerHTML = '預備鐘已響<br>請準備考試';
                        }
                        currentExamInfo.classList.add('multiline');
                        remainingBox.classList.add('warning');
                    }
                } else {
                    remainingTime.textContent = '--:--:--';
                    currentExamInfo.textContent = '今日課程已結束';
                    currentExamInfo.classList.add('multiline');
                }
            }
        }

        // 判斷是否為自習類科目（這些科目不計入考試倒數）
        function isSelfStudySubject(subjectName) {
            if (!subjectName) return false;
            var name = subjectName.trim().toLowerCase();
            // 自習相關關鍵字
            var selfStudyKeywords = ['自習', '自修', '複習', '温習', '溫習', '休息', '空堂', '午休', '午餐', '早自習', '晚自習'];
            for (var i = 0; i < selfStudyKeywords.length; i++) {
                if (name.indexOf(selfStudyKeywords[i]) !== -1) {
                    return true;
                }
            }
            return false;
        }

        // 格式化倒數時間
        function formatCountdown(totalSeconds) {
            if (totalSeconds < 0) return '--:--:--';
            
            var hours = Math.floor(totalSeconds / 3600);
            var minutes = Math.floor((totalSeconds % 3600) / 60);
            var seconds = totalSeconds % 60;
            
            return String(hours).padStart(2, '0') + ':' + String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
        }

        // 更新節次狀態
        function updatePeriodStatus(now) {
            var currentMinutes = now.getHours() * 60 + now.getMinutes();
            var activePeriodId = null;
            var nextUpcomingPeriodId = null;
            
            for (var i = 0; i < periods.length; i++) {
                var period = periods[i];
                var periodElement = document.getElementById('period-' + period.id);
                var startInput = document.getElementById('start-' + period.id);
                var endInput = document.getElementById('end-' + period.id);
                
                periodElement.classList.remove('active', 'completed', 'upcoming');
                
                if (startInput.value && endInput.value) {
                    var startMinutes = timeToMinutes(startInput.value);
                    var endMinutes = timeToMinutes(endInput.value);
                    
                    if (currentMinutes >= startMinutes && currentMinutes < endMinutes) {
                        periodElement.classList.add('active');
                        activePeriodId = period.id;
                    } else if (currentMinutes >= endMinutes) {
                        periodElement.classList.add('completed');
                    } else if (currentMinutes < startMinutes) {
                        periodElement.classList.add('upcoming');
                        // 記錄第一個即將到來的節次
                        if (nextUpcomingPeriodId === null) {
                            nextUpcomingPeriodId = period.id;
                        }
                    }
                }
            }
            
            // 自動滾動到當前或即將進行的節次
            scrollToCurrentPeriod(activePeriodId, nextUpcomingPeriodId);
        }

        // 追蹤上次滾動的節次，避免重複滾動
        var lastScrolledPeriodId = null;

        // 自動滾動到當前或即將進行的節次
        function scrollToCurrentPeriod(activePeriodId, nextUpcomingPeriodId) {
            var targetPeriodId = activePeriodId || nextUpcomingPeriodId;
            
            // 如果沒有目標節次，或與上次相同，不進行滾動
            if (!targetPeriodId || targetPeriodId === lastScrolledPeriodId) {
                return;
            }
            
            var scheduleList = document.getElementById('scheduleList');
            var targetElement = document.getElementById('period-' + targetPeriodId);
            
            if (scheduleList && targetElement) {
                // 計算滾動位置，讓目標節次顯示在列表上方 1/3 處
                var listRect = scheduleList.getBoundingClientRect();
                var targetRect = targetElement.getBoundingClientRect();
                var scrollOffset = targetElement.offsetTop - scheduleList.offsetTop - (listRect.height / 4);
                
                scheduleList.scrollTo({
                    top: Math.max(0, scrollOffset),
                    behavior: 'smooth'
                });
                
                lastScrolledPeriodId = targetPeriodId;
            }
        }

        // 計算缺席人數
        function updateAbsentCount() {
            var expected = parseInt(document.getElementById('expectedCount').value) || 0;
            var actual = parseInt(document.getElementById('actualCount').value) || 0;
            document.getElementById('absentCount').value = Math.max(0, expected - actual);
        }

        // 切換規則編輯模式（雙擊進入編輯）
        function toggleRulesEdit() {
            var rulesContent = document.getElementById('rulesContent');
            var rulesList = document.getElementById('rulesList');
            var rulesTextarea = document.getElementById('rulesTextarea');
            
            if (rulesTextarea.style.display === 'none' || rulesTextarea.style.display === '') {
                // 進入編輯模式
                var liElements = rulesList.querySelectorAll('li');
                var rules = [];
                for (var i = 0; i < liElements.length; i++) {
                    rules.push(liElements[i].textContent);
                }
                rulesTextarea.value = rules.join('\n');
                rulesContent.style.display = 'none';
                rulesTextarea.style.display = 'block';
                rulesTextarea.focus();
                // 暫停輪播
                clearInterval(carouselInterval);
                document.getElementById('carouselProgress').style.animationPlayState = 'paused';
            }
        }

        // 儲存規則編輯（失去焦點時自動儲存）
        function saveRulesEdit() {
            var rulesContent = document.getElementById('rulesContent');
            var rulesList = document.getElementById('rulesList');
            var rulesTextarea = document.getElementById('rulesTextarea');
            
            // 儲存並退出編輯模式
            var rulesArr = rulesTextarea.value.split('\n').filter(function(r) { return r.trim(); });
            var rulesHtml = '';
            for (var i = 0; i < rulesArr.length; i++) {
                rulesHtml += '<li>' + rulesArr[i] + '</li>';
            }
            rulesList.innerHTML = rulesHtml;
            rulesTextarea.style.display = 'none';
            rulesContent.style.display = 'block';
            saveToLocalStorage();
            // 恢復輪播
            startCarouselTimer();
            document.getElementById('carouselProgress').style.animationPlayState = 'running';
        }

        // 切換左側考試科目面板收納
        function toggleSchedulePanel() {
            var panel = document.getElementById('schedulePanel');
            panel.classList.toggle('collapsed');
            saveSchedulePanelState();
        }

        // 儲存面板狀態
        function saveSchedulePanelState() {
            var panel = document.getElementById('schedulePanel');
            localStorage.setItem('schedulePanelCollapsed', panel.classList.contains('collapsed'));
        }

        // 載入面板狀態
        function loadSchedulePanelState() {
            var isCollapsed = localStorage.getItem('schedulePanelCollapsed') === 'true';
            var panel = document.getElementById('schedulePanel');
            if (isCollapsed) {
                panel.classList.add('collapsed');
            }
        }

        // 全螢幕切換
        function toggleFullscreen() {
            var btn = document.getElementById('fullscreenBtn');
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                btn.innerHTML = '✖ 結束全螢幕';
                btn.title = '退出全螢幕模式';
            } else {
                document.exitFullscreen();
                btn.innerHTML = '⛶ 全螢幕';
                btn.title = '切換全螢幕模式';
            }
        }

        // 監聽全螢幕狀態變化（處理 ESC 鍵退出等情況）
        document.addEventListener('fullscreenchange', function() {
            var btn = document.getElementById('fullscreenBtn');
            if (document.fullscreenElement) {
                btn.innerHTML = '✖ 結束全螢幕';
                btn.title = '退出全螢幕模式';
            } else {
                btn.innerHTML = '⛶ 全螢幕';
                btn.title = '切換全螢幕模式';
            }
        });

        // 切換底部控制列顯示/隱藏
        function toggleFooter() {
            var footer = document.querySelector('.footer');
            var toggleBtn = document.getElementById('toggleFooterBtn');
            
            footer.classList.toggle('hidden');
            
            if (footer.classList.contains('hidden')) {
                toggleBtn.innerHTML = '⚙️ 顯示控制列';
                toggleBtn.title = '顯示控制面板';
            } else {
                toggleBtn.innerHTML = '⚙️ 隱藏控制列';
                toggleBtn.title = '隱藏控制面板';
            }
            
            // 儲存狀態
            localStorage.setItem('footerHidden', footer.classList.contains('hidden'));
        }

        // 載入控制列顯示狀態
        function loadFooterState() {
            var isHidden = localStorage.getItem('footerHidden') === 'true';
            var footer = document.querySelector('.footer');
            var toggleBtn = document.getElementById('toggleFooterBtn');
            
            if (isHidden) {
                footer.classList.add('hidden');
                toggleBtn.innerHTML = '⚙️ 顯示控制列';
                toggleBtn.title = '顯示控制面板';
            } else {
                toggleBtn.innerHTML = '⚙️ 隱藏控制列';
                toggleBtn.title = '隱藏控制面板';
            }
        }

        // 儲存資料到 localStorage
        function saveToLocalStorage() {
            var periodsData = [];
            for (var i = 0; i < periods.length; i++) {
                var p = periods[i];
                var periodData = {
                    id: p.id,
                    type: p.type,
                    startTime: document.getElementById('start-' + p.id).value,
                    endTime: document.getElementById('end-' + p.id).value
                };
                // 只有考試節次有科目欄位
                if (p.type === 'exam') {
                    var subjectInput = document.getElementById('subject-' + p.id);
                    periodData.subject = subjectInput ? subjectInput.value : '';
                }
                periodsData.push(periodData);
            }
            var rulesLiElements = document.getElementById('rulesList').querySelectorAll('li');
            var rulesData = [];
            for (var j = 0; j < rulesLiElements.length; j++) {
                rulesData.push(rulesLiElements[j].textContent);
            }
            var data = {
                periods: periodsData,
                attendance: {
                    expected: document.getElementById('expectedCount').value,
                    actual: document.getElementById('actualCount').value,
                    remarks: document.getElementById('remarks').value
                },
                rules: rulesData
            };
            
            localStorage.setItem('examDashboardData', JSON.stringify(data));
        }

        // 從 localStorage 載入資料
        function loadFromLocalStorage() {
            // 先載入預設時間，確保所有節次都有時間
            loadDefaultTimes();
            
            var savedData = localStorage.getItem('examDashboardData');
            if (savedData) {
                var data = JSON.parse(savedData);
                
                // 載入節次資料（覆蓋預設時間）
                for (var i = 0; i < data.periods.length; i++) {
                    var p = data.periods[i];
                    var startEl = document.getElementById('start-' + p.id);
                    var endEl = document.getElementById('end-' + p.id);
                    
                    // 只有找到對應元素才載入
                    if (startEl && p.startTime) startEl.value = p.startTime;
                    if (endEl && p.endTime) endEl.value = p.endTime;
                    updateDuration(p.id);
                    
                    // 只有考試節次有科目欄位
                    if (p.type === 'exam' || (!p.type && typeof p.id === 'number')) {
                        var subjectEl = document.getElementById('subject-' + p.id);
                        if (subjectEl) {
                            subjectEl.value = p.subject || '';
                            updateSubjectDisplay(p.id);
                        }
                    }
                }
                
                // 載入人數統計
                if (data.attendance) {
                    document.getElementById('expectedCount').value = data.attendance.expected || 0;
                    document.getElementById('actualCount').value = data.attendance.actual || 0;
                    document.getElementById('remarks').value = data.attendance.remarks || '';
                    updateAbsentCount();
                }
                
                // 載入考試規則
                if (data.rules && data.rules.length > 0) {
                    var rulesHtml = '';
                    for (var j = 0; j < data.rules.length; j++) {
                        rulesHtml += '<li>' + data.rules[j] + '</li>';
                    }
                    document.getElementById('rulesList').innerHTML = rulesHtml;
                }
            }
        }

        // 載入預設考試時間
        function loadDefaultTimes() {
            for (var i = 0; i < periods.length; i++) {
                var period = periods[i];
                document.getElementById('start-' + period.id).value = period.defaultStart;
                document.getElementById('end-' + period.id).value = period.defaultEnd;
                updateDuration(period.id);
            }
        }

        // 儲存資料（顯示提示）
        function saveData() {
            saveToLocalStorage();
            alert('資料已儲存！');
        }

        // 載入資料
        function loadData() {
            if (confirm('確定要載入已儲存的資料嗎？目前的資料將被覆蓋。')) {
                loadFromLocalStorage();
                alert('資料已載入！');
            }
        }

        // 清除資料
        function clearData() {
            if (confirm('確定要清除所有資料嗎？此操作無法復原。')) {
                localStorage.removeItem('examDashboardData');
                location.reload();
            }
        }

        // 監聽人數輸入變化
        document.getElementById('expectedCount').addEventListener('input', updateAbsentCount);
        document.getElementById('actualCount').addEventListener('input', updateAbsentCount);

        // 監聽人數和備註變化以儲存
        document.getElementById('expectedCount').addEventListener('change', saveToLocalStorage);
        document.getElementById('actualCount').addEventListener('change', saveToLocalStorage);
        document.getElementById('remarks').addEventListener('change', saveToLocalStorage);

        // 初始化
        initScheduleList();
        loadFromLocalStorage();
        loadFooterState();
        loadSchedulePanelState();
        updateTimeOffsetDisplay();
        updateCurrentTime();
        setInterval(updateCurrentTime, 1000);

        // 頁面載入後延遲執行初始滾動（確保 DOM 完全渲染）
        setTimeout(function() {
            lastScrolledPeriodId = null; // 重設滾動追蹤，確保初始滾動會執行
            var now = new Date();
            now.setSeconds(now.getSeconds() + timeOffsetSeconds);
            updatePeriodStatus(now);
        }, 500);

        // 鍵盤快捷鍵
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F11') {
                e.preventDefault();
                toggleFullscreen();
            }
            // 左右鍵切換輪播
            if (e.key === 'ArrowLeft') {
                prevSlide();
            }
            if (e.key === 'ArrowRight') {
                nextSlide();
            }
        });

        // 輪播功能
        var currentSlide = 0;
        var totalSlides = 2;
        var carouselInterval;
        var CAROUSEL_DELAY = 8000; // 8秒切換

        function updateCarousel() {
            var slides = document.getElementById('carouselSlides');
            var dots = document.querySelectorAll('.carousel-dot');
            var progress = document.getElementById('carouselProgress');
            
            slides.style.transform = 'translateX(-' + (currentSlide * 100) + '%)';
            
            // 更新所有頁面的 carousel-dot 狀態
            for (var i = 0; i < dots.length; i++) {
                var dot = dots[i];
                // 每個頁面有 2 個 dot，所以用 index % 2
                if ((i % totalSlides) === currentSlide) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            }
            
            // 重置進度條動畫
            progress.style.animation = 'none';
            progress.offsetHeight; // 強制重繪
            progress.style.animation = 'timerProgress ' + (CAROUSEL_DELAY / 1000) + 's linear infinite';
        }

        function nextSlide() {
            currentSlide = (currentSlide + 1) % totalSlides;
            updateCarousel();
            resetCarouselTimer();
        }

        function prevSlide() {
            currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
            updateCarousel();
            resetCarouselTimer();
        }

        function goToSlide(index) {
            currentSlide = index;
            updateCarousel();
            resetCarouselTimer();
        }

        function startCarouselTimer() {
            carouselInterval = setInterval(nextSlide, CAROUSEL_DELAY);
        }

        function resetCarouselTimer() {
            clearInterval(carouselInterval);
            startCarouselTimer();
        }

        // 滑鼠懸停時暫停輪播
        document.getElementById('infoCarousel').addEventListener('mouseenter', function() {
            clearInterval(carouselInterval);
            document.getElementById('carouselProgress').style.animationPlayState = 'paused';
        });

        document.getElementById('infoCarousel').addEventListener('mouseleave', function() {
            startCarouselTimer();
            document.getElementById('carouselProgress').style.animationPlayState = 'running';
        });

        // 啟動輪播
        startCarouselTimer();

        // ===== 主題切換功能 =====
        function toggleTheme() {
            var body = document.body;
            var themeIcon = document.getElementById('themeIcon');
            var themeText = document.getElementById('themeText');
            
            if (body.classList.contains('light-mode')) {
                // 切換到深色模式
                body.classList.remove('light-mode');
                themeIcon.textContent = '🌙';
                themeText.textContent = '深色';
                localStorage.setItem('theme', 'dark');
            } else {
                // 切換到淺色模式
                body.classList.add('light-mode');
                themeIcon.textContent = '☀️';
                themeText.textContent = '淺色';
                localStorage.setItem('theme', 'light');
            }
        }

        // 載入主題設定
        function loadTheme() {
            var savedTheme = localStorage.getItem('theme');
            var themeIcon = document.getElementById('themeIcon');
            var themeText = document.getElementById('themeText');
            
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                themeIcon.textContent = '☀️';
                themeText.textContent = '淺色';
            } else {
                document.body.classList.remove('light-mode');
                themeIcon.textContent = '🌙';
                themeText.textContent = '深色';
            }
        }

        // 初始化主題
        loadTheme();

        // ===== 文字縮放功能 =====
        var zoomLevels = {
            remarks: 100,
            rules: 100
        };
        var ZOOM_MIN = 70;
        var ZOOM_MAX = 150;
        var ZOOM_STEP = 10;

        function zoomText(target, direction) {
            // 計算新的縮放比例
            var newLevel = zoomLevels[target] + (direction * ZOOM_STEP);
            newLevel = Math.max(ZOOM_MIN, Math.min(ZOOM_MAX, newLevel));
            zoomLevels[target] = newLevel;

            // 更新顯示
            document.getElementById(target + '-zoom-level').textContent = newLevel + '%';

            // 應用縮放
            if (target === 'remarks') {
                var remarksInput = document.getElementById('remarks');
                if (remarksInput) {
                    remarksInput.style.fontSize = (newLevel / 100) + 'em';
                }
            } else if (target === 'rules') {
                var rulesContent = document.getElementById('rulesContent');
                var rulesTextarea = document.getElementById('rulesTextarea');
                if (rulesContent) {
                    rulesContent.style.fontSize = (newLevel / 100) + 'em';
                }
                if (rulesTextarea) {
                    rulesTextarea.style.fontSize = (newLevel / 100) + 'em';
                }
            }

            // 儲存設定
            saveZoomSettings();
        }

        function saveZoomSettings() {
            localStorage.setItem('zoomLevels', JSON.stringify(zoomLevels));
        }

        function loadZoomSettings() {
            var saved = localStorage.getItem('zoomLevels');
            if (saved) {
                var parsed = JSON.parse(saved);
                if (parsed.remarks) {
                    zoomLevels.remarks = parsed.remarks;
                    document.getElementById('remarks-zoom-level').textContent = parsed.remarks + '%';
                    var remarksInput = document.getElementById('remarks');
                    if (remarksInput) {
                        remarksInput.style.fontSize = (parsed.remarks / 100) + 'em';
                    }
                }
                if (parsed.rules) {
                    zoomLevels.rules = parsed.rules;
                    document.getElementById('rules-zoom-level').textContent = parsed.rules + '%';
                    var rulesContent = document.getElementById('rulesContent');
                    var rulesTextarea = document.getElementById('rulesTextarea');
                    if (rulesContent) {
                        rulesContent.style.fontSize = (parsed.rules / 100) + 'em';
                    }
                    if (rulesTextarea) {
                        rulesTextarea.style.fontSize = (parsed.rules / 100) + 'em';
                    }
                }
            }
        }

        // 初始化縮放設定
        loadZoomSettings();

        // ===== 觸控螢幕鍵盤處理 =====
        // 偵測是否為觸控設備
        function isTouchDevice() {
            return ('ontouchstart' in window) || 
                   (navigator.maxTouchPoints > 0) || 
                   (navigator.msMaxTouchPoints > 0);
        }

        // 浮動輸入框狀態
        var floatingInputActive = false;
        var floatingInputSource = null;
        var floatingInputType = null;

        // 開啟浮動輸入區域
        function openFloatingInput(sourceElement, title, inputType) {
            if (!isTouchDevice()) return false;

            floatingInputSource = sourceElement;
            floatingInputType = inputType;
            floatingInputActive = true;

            // 暫停輪播
            clearInterval(carouselInterval);
            var progressEl = document.getElementById('carouselProgress');
            if (progressEl) {
                progressEl.style.animationPlayState = 'paused';
            }

            // 設定標題
            document.getElementById('floatingInputTitle').textContent = title;
            document.getElementById('inputHintText').textContent = '正在輸入：' + title;

            // 建立輸入框
            var body = document.getElementById('floatingInputBody');
            var inputElement;

            if (inputType === 'text') {
                inputElement = document.createElement('input');
                inputElement.type = 'text';
                inputElement.value = sourceElement.value || '';
                inputElement.placeholder = sourceElement.placeholder || '';
            } else {
                inputElement = document.createElement('textarea');
                inputElement.value = sourceElement.value || sourceElement.textContent || '';
                inputElement.placeholder = sourceElement.placeholder || '';
            }

            inputElement.id = 'floatingInput';
            body.innerHTML = '';
            body.appendChild(inputElement);

            // 顯示浮動區域
            document.getElementById('inputOverlay').classList.add('active');
            document.getElementById('floatingInputContainer').classList.add('active');
            document.getElementById('inputHintBar').classList.add('active');
            document.body.classList.add('keyboard-open');

            // 焦點到輸入框
            setTimeout(function() {
                inputElement.focus();
                if (inputType === 'text') {
                    inputElement.select();
                }
            }, 100);

            // 監聽輸入變化
            inputElement.addEventListener('input', function() {
                syncFloatingInput();
            });

            return true;
        }

        // 同步浮動輸入框內容到原始元素
        function syncFloatingInput() {
            var floatingInput = document.getElementById('floatingInput');
            if (!floatingInput || !floatingInputSource) return;

            if (floatingInputSource.tagName === 'TEXTAREA' || floatingInputSource.tagName === 'INPUT') {
                floatingInputSource.value = floatingInput.value;
            }
        }

        // 關閉浮動輸入區域
        function closeFloatingInput() {
            if (!floatingInputActive) return;

            // 同步最終內容
            syncFloatingInput();

            // 隱藏浮動區域
            document.getElementById('inputOverlay').classList.remove('active');
            document.getElementById('floatingInputContainer').classList.remove('active');
            document.getElementById('inputHintBar').classList.remove('active');
            document.body.classList.remove('keyboard-open');

            // 處理特殊情況
            if (floatingInputSource) {
                // 如果是科目輸入框，更新顯示
                if (floatingInputSource.classList.contains('subject-input')) {
                    var periodId = floatingInputSource.id.replace('subject-', '');
                    updateSubjectDisplay(parseInt(periodId));
                }
                // 如果是規則輸入框，儲存編輯
                if (floatingInputSource.id === 'rulesTextarea') {
                    saveRulesEdit();
                }
                // 儲存到 localStorage
                saveToLocalStorage();
            }

            // 恢復輪播
            startCarouselTimer();
            var progressEl = document.getElementById('carouselProgress');
            if (progressEl) {
                progressEl.style.animationPlayState = 'running';
            }

            floatingInputActive = false;
            floatingInputSource = null;
            floatingInputType = null;
        }

        // 綁定備註輸入框事件
        var remarksInput = document.getElementById('remarks');
        if (remarksInput) {
            remarksInput.addEventListener('focus', function(e) {
                if (openFloatingInput(this, '備註事項', 'textarea')) {
                    e.preventDefault();
                    this.blur();
                }
            });
        }

        // 綁定考試規則輸入框事件
        var rulesTextareaEl = document.getElementById('rulesTextarea');
        if (rulesTextareaEl) {
            rulesTextareaEl.addEventListener('focus', function(e) {
                if (openFloatingInput(this, '考試規則', 'textarea')) {
                    e.preventDefault();
                    this.blur();
                }
            });
        }

        // 綁定考試科目輸入框事件
        function bindSubjectInputEvents() {
            var subjectInputs = document.querySelectorAll('.subject-input');
            for (var i = 0; i < subjectInputs.length; i++) {
                var input = subjectInputs[i];
                // 避免重複綁定
                if (input.dataset.floatingBound) continue;
                input.dataset.floatingBound = 'true';
                
                input.addEventListener('focus', function(e) {
                    if (openFloatingInput(this, '考試科目', 'text')) {
                        e.preventDefault();
                        this.blur();
                    }
                });
            }
        }

        // 初始化科目輸入框事件
        bindSubjectInputEvents();

        // 使用 visualViewport API 來調整浮動輸入區域位置
        if (window.visualViewport) {
            window.visualViewport.addEventListener('resize', function() {
                if (floatingInputActive) {
                    var container = document.getElementById('floatingInputContainer');
                    var availableHeight = window.visualViewport.height;
                    // 確保浮動區域在可見範圍內
                    container.style.maxHeight = Math.min(availableHeight * 0.45, 300) + 'px';
                }
            });

            window.visualViewport.addEventListener('scroll', function() {
                if (floatingInputActive) {
                    var container = document.getElementById('floatingInputContainer');
                    container.style.top = (window.visualViewport.offsetTop + 10) + 'px';
                }
            });
        }

        // 按下 Enter 鍵時關閉單行輸入框
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && floatingInputActive && floatingInputType === 'text') {
                e.preventDefault();
                closeFloatingInput();
            }
        });
    </script>
</body>
</html>
